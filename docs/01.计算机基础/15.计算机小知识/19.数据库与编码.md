---
title: æ•°æ®åº“ä¸ç¼–ç 
date: 2022-12-21 09:11:13
permalink: /literacy/character-encoding-database/
categories:
  - è®¡ç®—æœºåŸºç¡€
  - è®¡ç®—æœºå°çŸ¥è¯†
tags:
  - 
feed:
  enable: true
description: ä»¥ MySQL ä¸ºä¾‹ã€‚åœ¨ MySQL ä¸­ï¼Œutf8 ç¼–ç å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ utf8ï¼Œè€Œæ˜¯ utf8mb3ã€‚utf8mb3 æ”¯æŒçš„å­—ç¬¦é›†æ˜¯ 0~65535 ä¹‹é—´çš„ BMP çš„å­—ç¬¦ï¼Œæœ€å¤šæ”¯æŒ 3 ä¸ªå­—èŠ‚ï¼Œä¸€äº›ç”Ÿåƒ»å­—å’Œ emoji æ˜¯ä¸æ”¯æŒã€‚
---
# 19.æ•°æ®åº“ä¸ç¼–ç 

ä»¥ MySQL ä¸ºä¾‹ã€‚åœ¨ MySQL ä¸­ï¼Œutf8 ç¼–ç å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ utf8ï¼Œè€Œæ˜¯ utf8mb3ã€‚utf8mb3 æ”¯æŒçš„å­—ç¬¦é›†æ˜¯ 0~65535 ä¹‹é—´çš„ BMP çš„å­—ç¬¦ï¼Œæœ€å¤šæ”¯æŒ 3 ä¸ªå­—èŠ‚ï¼Œä¸€äº›ç”Ÿåƒ»å­—å’Œ emoji æ˜¯ä¸æ”¯æŒã€‚

<!-- more -->

ä»¥ MySQL ä¸ºä¾‹ã€‚åœ¨ MySQL ä¸­ï¼Œutf8 ç¼–ç å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ utf8ï¼Œè€Œæ˜¯ utf8mb3ã€‚utf8mb3 æ”¯æŒçš„å­—ç¬¦é›†æ˜¯ 0~65535 ä¹‹é—´çš„ BMP çš„å­—ç¬¦ï¼Œæœ€å¤šæ”¯æŒ 3 ä¸ªå­—èŠ‚ï¼Œä¸€äº›ç”Ÿåƒ»å­—å’Œ emoji æ˜¯ä¸æ”¯æŒã€‚

è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¦‚æœä½ æ•°æ®åº“ä½¿ç”¨çš„æ˜¯ utf8mb3 ç¼–ç ï¼Œé‚£ä¹ˆåœ¨ insert ä¸€äº› 4 å­—èŠ‚çš„å­—ç¬¦çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼š

```java
insert into t (name) value('ğŸ˜‚')
SQL é”™è¯¯ [1366] [HY000]: Incorrect string value: '\xF0\x9F\x98\x82' for column 'name' at row 1

insert into t (name) value('ğ¡‹¾')
SQL é”™è¯¯ [1366] [HY000]: Incorrect string value: '\xF0\xA1\x88\xBE' for column 'name' at row 1
```

â€

å…¶å®ï¼Œè¿™å¹¶ä¸æ˜¯ MySQL è‡ªå·±çš„é—®é¢˜ï¼Œè€Œæ˜¯ Unicode åœ¨ä¸€å¼€å§‹çš„æ—¶å€™å°±æ²¡ç¡®å®šå¥½åˆ°åº•ç”¨å‡ ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œå½“æ—¶çš„æ–¹æ¡ˆå¹¶ä¸å®Œå–„ï¼›ç­‰åˆ°äº†åæ¥ï¼ŒUnicode æ ‡å‡†æ‰æ­£å¼å‘å¸ƒï¼Œç¡®å®šäº†å­˜å‚¨æ–¹æ¡ˆã€‚

äºæ˜¯ï¼Œåœ¨ 2010 å¹´ï¼ŒMySQL å‘å¸ƒäº† MySQL 5.53ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“æ—¶å¯ä»¥ç”¨ä¸€ä¸ªæ–°çš„å­—ç¬¦é›† utf8mb4ï¼Œæ”¯æŒ 4 ä¸ªå­—èŠ‚çš„å­—ç¬¦

å®˜æ–¹æ–‡æ¡£é†’ç›®çš„æé†’äº†å¤§å®¶è¯´ utf8mb3 ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤ï¼Œå¹¶å»ºè®®ç”¨æˆ·ä¼˜å…ˆä½¿ç”¨ utf8mb4ã€‚æ‰€ä»¥åœ¨åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™ï¼Œç¡®ä¿çš„ä½¿ç”¨æ˜¯ utf8mb4ï¼Œè€Œä¸æ˜¯ utf8mb3ã€‚

â€

å®˜æ–¹çš„ä¸€äº›è¯´æ˜ï¼š[MySQL :: MySQL 8.0 Reference Manual :: 10.9.2 The utf8mb3 Character Set (3-Byte UTF-8 Unicode Encoding)](https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html)

> Applications that use UTF-8 data but require supplementary character support should use `utf8mb4`â€‹ rather than `utf8mb3`â€‹ (see [Section 10.9.1, â€œThe utf8mb4 Character Set (4-Byte UTF-8 Unicode Encoding)â€](https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb4.html "10.9.1Â The utf8mb4 Character Set (4-Byte UTF-8 Unicode Encoding)")).

â€

â€

å¯ä»¥é€šè¿‡æŸ¥çœ‹æ•°æ®åº“çš„å»ºè¡¨è¯­å¥æ¥æ£€æŸ¥ï¼š

```sql
show create database æ•°æ®åº“å\G;
-- ä¾‹å¦‚
mysql> show create database dblog\G;
*************************** 1. row ***************************
       Database: dblog
Create Database: CREATE DATABASE `dblog` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */ /*!80016 DEFAULT ENCRYPTION='N' */
1 row in set (0.00 sec)
```

ç¬”è€…åœ¨ MySQL 8.0.27 ä¸‹å°è¯•äº†ä¸‹ï¼Œé»˜è®¤éƒ½æ˜¯ç”¨çš„ utf8mb4 ç¼–ç äº†ï¼Œè€Œåœ¨å¾ˆä¹…ä¹‹å‰ï¼Œé»˜è®¤ç¼–ç æ˜¯ utf8mb3ã€‚

å¦‚æœæ˜¯æ—©æœŸçš„æ•°æ®åº“è¡¨ï¼Œæœ‰éœ€æ±‚è¦å…¼å®¹ 4 ä¸ªå­—èŠ‚çš„å­—ç¬¦çš„è¯ï¼Œå¯ä»¥ä¿®æ”¹å¯¹åº”çš„å­—æ®µçš„ç¼–ç æˆ–æ•°æ®åº“çš„ç¼–ç ã€‚

â€

â€

â€

## ç¼–ç çš„é‡è¦æ€§

ç¼–ç æ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ã€‚ç°ä»£å¾ˆå¤šç³»ç»Ÿéƒ½è¦æ±‚æ”¯æŒ Unicodeã€‚å¦‚æœä¸æ”¯æŒï¼Œæœ‰ä»€ä¹ˆåæœå‘¢ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæŸä¸ªäººåå­—å¸¦æœ‰ç”Ÿåƒ»å­—ï¼Œé“¶è¡Œçš„ç³»ç»Ÿä¸æ”¯æŒï¼Œé‚£ä¹ˆè¿™ä¸ªå®¢æˆ·å°±ä¸èƒ½å»è¯¥é“¶è¡Œåšä¸šåŠ¡ï¼Œç›´æ¥æŸå¤±äº†ä¸€åå®¢æˆ·ã€‚

â€

ä¾‹å¦‚ï¼šåœ¨ [æœ‰æ²¡æœ‰è°çš„æœ‹å‹åå­—ä¸­å«æœ‰â€œä¶®â€å­—çš„ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/28622274) é‡Œæœ‰äººæåˆ°ï¼š

> æœ¬äººæœ‰ä¸¤å¼ å‚¨è“„å¡ï¼Œæ‹›å•†å’Œå·¥å•†ï¼Œæ‹›å•†çš„æˆ·åæ˜¯æŸä¶®ï¼Œå·¥å•†é“¶è¡Œçš„æˆ·åæ˜¯æŸï¼ˆYAN3ï¼‰ï¼Œäº²èº«ç»å†è¯æ˜ï¼šæ‹›å•†å‚¨è“„å¡æ— æ³•å˜æ›´ä¸ºå…¬ç§¯é‡‘è”åå¡ï¼Œä¸»è¦åŸå› æ˜¯å§“åä¸ä¸€è‡´ï¼Œå› æ­¤è‚¯å®šæ²¡æœ‰åŠæ³•æå–å…¬ç§¯é‡‘

â€

[ä¸€ä¸ªåå­—å«â€œä¶®â€çš„äººçš„è‹¦æ¼ï¼šå¼€ä¸äº†é“¶è¡Œè´¦æˆ·ï¼Œç”¨ä¸äº†å¾®ä¿¡ã€æ”¯ä»˜å®](https://mp.weixin.qq.com/s/1q8Ag21UrEDgRwkqKV41pQ)

> è¿‘æ—¥ï¼Œå¤šä½äººå£«å‘è®°è€…è¡¨ç¤ºï¼Œè‡ªå·±çš„åå­—ä¸­å«æœ‰ â€œä¶®â€ç­‰æ±‰å­—ï¼Œåœ¨åŠç†å…¬ç§¯é‡‘ã€é“¶è¡Œå¡ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜ã€æ‰‹æœºå¡ç­‰é‡‘èã€é€šä¿¡ä¸šåŠ¡æ—¶ï¼Œåå­—æ— æ³•è¢«éªŒè¯ï¼Œå¯¼è‡´ä¸šåŠ¡æ— æ³•åŠç†ã€‚
>
> ç”šè‡³ï¼Œå› ä¸ºæ²¡æ³•ç”³è¯·é“¶è¡Œè´¦æˆ·ï¼Œå¾®ä¿¡ã€æ”¯ä»˜å®ä¹Ÿæ‹’ç»ä½¿ç”¨ï¼Œæœ‰çš„é“¶è¡Œå»ºè®®åå­—å¸¦æœ‰â€œä¶®â€å­—çš„ç”¨æˆ·æ”¹å›ç¹ä½“å­—â€œé¾‘â€ã€‚
>
> ç”Ÿåƒ»å­—å¸¦æ¥é‡‘èäº¤æ˜“ä¸­çš„éº»çƒ¦ï¼Œè¿™ä¸€æƒ…å†µå¹¶ä¸é²œè§ã€‚

â€

## æ¼”ç¤º

å®è·µå‡ºçœŸçŸ¥ï¼Œæˆ‘ä»¬æ¥æ¼”ç¤ºä¸‹ï¼Œæœ¬æ–‡æ˜¯åœ¨ Windows ä¸‹çš„ MySQL 5 æ¼”ç¤ºã€‚

é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†

```java
mysql> create database testunicode default character set utf8 collate utf8_general_ci;
Query OK, 1 row affected (0.00 sec)
```

â€

åˆ›å»ºå®Œåï¼Œå¯ä»¥æ£€æŸ¥ä¸‹è¯¥æ•°æ®åº“çš„ç¼–ç 

```java
mysql> show create database testunicode;
+------------+--------------------------------------------------------+
| Database    | Create Database                                                      |
+------------+--------------------------------------------------------+
| testunicode | CREATE DATABASE `testunicode` /*!40100 DEFAULT CHARACTER SET utf8 */ |
+-------------+--------------------------------------------------------+
1 row in set (0.00 sec)
```

â€

ä½¿ç”¨è¯¥æ•°æ®åº“å¹¶åˆ›å»ºè¡¨ï¼Œå¯ä»¥çœ‹åˆ°è¯¥è¡¨çš„é»˜è®¤ç¼–ç æ˜¯ UTF8

```java
mysql> use testunicode;
Database changed

mysql> create table t (name varchar(50));
Query OK, 0 rows affected (0.25 sec)

mysql> show create table t
CREATE TABLE `t` (
  `name` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

â€

å°è¯• insert ä¸€ä¸ª emojiï¼Œç¡®å®æœ‰æŠ¥é”™ï¼š

```java
insert into t (name) value('ğŸ˜‚')

SQL é”™è¯¯ [1366] [HY000]: Incorrect string value: '\xF0\x9F\x98\x82' for column 'name' at row 1
```

â€

æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•æ›´æ¢å­—ç¬¦é›†ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°è¡¨ï¼š

```java
mysql> ALTER DATABASE `testunicode`
DEFAULT CHARACTER SET utf8mb4
DEFAULT COLLATE utf8mb4_bin;

mysql> create table tu (name varchar(50))

mysql> show create table t
CREATE TABLE `t` (
  `name` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

â€

å°è¯•é‡æ–° insertï¼Œç»“æœæ˜¯èƒ½æˆåŠŸ insertï¼ˆæ²¡æœ‰æŠ¥é”™å°±æ˜¯æˆåŠŸï¼‰ï¼š

```java
mysql> insert into tu (name) value('ğŸ˜‚')
```

## å°ç»“

è™½ç„¶ç›®å‰ MySQL é»˜è®¤éƒ½æ˜¯ä½¿ç”¨ utf8mb4 äº†ï¼Œä½†ä¸€äº›æ—©æœŸçš„é¡¹ç›®è¿˜æ˜¯ä½¿ç”¨çš„ utf8mb3ï¼Œå¸Œæœ›è¯»è€…ä»¬å¦‚æœé‡åˆ°äº†è¯¥ç¼–ç é—®é¢˜èƒ½æœ‰æ€è·¯ï¼ŒçŸ¥é“æ˜¯æ€ä¹ˆå›äº‹ã€æ€ä¹ˆä¿®å¤ã€‚

è§¦ç±»æ—é€šï¼Œå…¶ä»–å…³ç³»å‹æ•°æ®åº“ï¼Œä¾‹å¦‚ Oracle ç­‰ï¼Œä¹Ÿéœ€è¦è€ƒè™‘ç¼–ç é—®é¢˜

â€

## å‚è€ƒ

è‹±æ–‡ç‰ˆï¼ˆéœ€ç§‘å­¦ä¸Šç½‘ï¼‰[In MySQL, never use â€œutf8â€. Use â€œutf8mb4â€. | by Adam Hooper | Medium](https://adamhooper.medium.com/in-mysql-never-use-utf8-use-utf8mb4-11761243e434)

ä¸­æ–‡ç‰ˆï¼š[è®°ä½ï¼Œæ°¸è¿œä¸è¦åœ¨ MySQL ä¸­ä½¿ç”¨â€œutf8â€_æ•°æ®åº“_Adam Hooper_InfoQ ç²¾é€‰æ–‡ç« ](https://www.infoq.cn/article/in-mysql-never-use-utf8-use-utf8)

[ä¸€ä¸ªåå­—å«â€œä¶®â€çš„äººçš„è‹¦æ¼ï¼šå¼€ä¸äº†é“¶è¡Œè´¦æˆ·ï¼Œç”¨ä¸äº†å¾®ä¿¡ã€æ”¯ä»˜å®](https://mp.weixin.qq.com/s/1q8Ag21UrEDgRwkqKV41pQ)

[æ›å…‰ MySQL çš„ ä¸€ä¸ªå‘ï¼Œä¸è¦å†ä½¿ç”¨ UTF-8 äº†ï¼Ÿ](https://mp.weixin.qq.com/s/z7FU3eMACjm46bpMMmDOBg)

â€
