---
title: æ•°æ®åº“ä¸ç¼–ç 
date: 2022-12-21 09:11:13
permalink: /literacy/character-encoding-database/
categories:
  - è®¡ç®—æœºåŸºç¡€
  - è®¡ç®—æœºå°çŸ¥è¯†
tags:
  - 
---

# 19.æ•°æ®åº“ä¸ç¼–ç 

ã€€ã€€â€![](https://image.peterjxl.com/blog/Rin.jpeg)


ã€€ã€€ä»¥MySQLä¸ºä¾‹ã€‚åœ¨MySQLä¸­ï¼Œutf8ç¼–ç å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„utf8ï¼Œè€Œæ˜¯utf8mb3ã€‚utf8mb3æ”¯æŒçš„å­—ç¬¦é›†æ˜¯0~65535ä¹‹é—´çš„BMPçš„å­—ç¬¦ï¼Œæœ€å¤šæ”¯æŒ3ä¸ªå­—èŠ‚ï¼Œä¸€äº›ç”Ÿåƒ»å­—å’Œemojiæ˜¯ä¸æ”¯æŒã€‚

<!-- more -->

ã€€ã€€è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¦‚æœä½ æ•°æ®åº“ä½¿ç”¨çš„æ˜¯utf8mb3ç¼–ç ï¼Œé‚£ä¹ˆåœ¨insertä¸€äº›4å­—èŠ‚çš„å­—ç¬¦çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼š

```java
insert into t (name) value('ğŸ˜‚')
SQL é”™è¯¯ [1366] [HY000]: Incorrect string value: '\xF0\x9F\x98\x82' for column 'name' at row 1

insert into t (name) value('ğ¡‹¾')
SQL é”™è¯¯ [1366] [HY000]: Incorrect string value: '\xF0\xA1\x88\xBE' for column 'name' at row 1
```

ã€€ã€€â€
    å…¶å®ï¼Œè¿™å¹¶ä¸æ˜¯MySQLè‡ªå·±çš„é—®é¢˜ï¼Œè€Œæ˜¯Unicodeåœ¨ä¸€å¼€å§‹çš„æ—¶å€™å°±æ²¡ç¡®å®šå¥½åˆ°åº•ç”¨å‡ ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œå½“æ—¶çš„æ–¹æ¡ˆå¹¶ä¸å®Œå–„ï¼›ç­‰åˆ°äº†åæ¥ï¼ŒUnicodeæ ‡å‡†æ‰æ­£å¼å‘å¸ƒï¼Œç¡®å®šäº†å­˜å‚¨æ–¹æ¡ˆã€‚

    äºæ˜¯ï¼Œåœ¨2010å¹´ ï¼ŒMySQLå‘å¸ƒäº†MySQL5.53ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“æ—¶å¯ä»¥ç”¨ä¸€ä¸ªæ–°çš„å­—ç¬¦é›†utf8mb4ï¼Œæ”¯æŒ4ä¸ªå­—èŠ‚çš„å­—ç¬¦
ã€€ã€€â€

ã€€ã€€å®˜æ–¹æ–‡æ¡£é†’ç›®çš„æé†’äº†å¤§å®¶è¯´utf8mb3ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤ï¼Œå¹¶å»ºè®®ç”¨æˆ·ä¼˜å…ˆä½¿ç”¨utf8mb4

ã€€ã€€æ‰€ä»¥åœ¨åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™ï¼Œç¡®ä¿çš„ä½¿ç”¨æ˜¯utf8mb4ï¼Œè€Œä¸æ˜¯utf8mb3ã€‚

ã€€ã€€â€

ã€€ã€€å®˜æ–¹çš„ä¸€äº›è¯´æ˜ï¼š[MySQL :: MySQL 8.0 Reference Manual :: 10.9.2 The utf8mb3 Character Set (3-Byte UTF-8 Unicode Encoding)](https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb3.html)

> Applications that use UTF-8 data but require supplementary character support should use `utf8mb4`â€‹ rather than `utf8mb3`â€‹ (see [Section 10.9.1, â€œThe utf8mb4 Character Set (4-Byte UTF-8 Unicode Encoding)â€](https://dev.mysql.com/doc/refman/8.0/en/charset-unicode-utf8mb4.html "10.9.1Â The utf8mb4 Character Set (4-Byte UTF-8 Unicode Encoding)")).

ã€€ã€€â€

ã€€ã€€â€

ã€€ã€€å¯ä»¥é€šè¿‡æŸ¥çœ‹æ•°æ®åº“çš„å»ºè¡¨è¯­å¥æ¥æ£€æŸ¥ï¼š

```sql
show create database æ•°æ®åº“å\G;
-- ä¾‹å¦‚
mysql> show create database dblog\G;
*************************** 1. row ***************************
       Database: dblog
Create Database: CREATE DATABASE `dblog` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */ /*!80016 DEFAULT ENCRYPTION='N' */
1 row in set (0.00 sec)
```

ã€€ã€€ç¬”è€…åœ¨MySQL 8.0.27ä¸‹å°è¯•äº†ä¸‹ï¼Œé»˜è®¤éƒ½æ˜¯ç”¨çš„utf8mb4ç¼–ç äº†ï¼Œè€Œåœ¨å¾ˆä¹…ä¹‹å‰ï¼Œé»˜è®¤ç¼–ç æ˜¯utf8mb3. 

ã€€ã€€å¦‚æœæ˜¯æ—©æœŸçš„æ•°æ®åº“è¡¨ï¼Œæœ‰éœ€æ±‚è¦å…¼å®¹4ä¸ªå­—èŠ‚çš„å­—ç¬¦çš„è¯ï¼Œå¯ä»¥ä¿®æ”¹å¯¹åº”çš„å­—æ®µçš„ç¼–ç æˆ–æ•°æ®åº“çš„ç¼–ç ã€‚

ã€€ã€€â€‹â€‹

## ç¼–ç çš„é‡è¦æ€§

ã€€ã€€ç¼–ç æ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ã€‚ç°ä»£å¾ˆå¤šç³»ç»Ÿéƒ½è¦æ±‚æ”¯æŒUnicodeã€‚å¦‚æœä¸æ”¯æŒï¼Œæœ‰ä»€ä¹ˆåæœå‘¢ï¼Ÿ

ã€€ã€€ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæŸä¸ªäººåå­—å¸¦æœ‰ç”Ÿåƒ»å­—ï¼Œé“¶è¡Œçš„ç³»ç»Ÿä¸æ”¯æŒï¼Œé‚£ä¹ˆè¿™ä¸ªå®¢æˆ·å°±ä¸èƒ½å»è¯¥é“¶è¡Œåšä¸šåŠ¡ï¼Œç›´æ¥æŸå¤±äº†ä¸€åå®¢æˆ·ã€‚

ã€€ã€€â€

ã€€ã€€ä¾‹å¦‚ï¼šåœ¨[æœ‰æ²¡æœ‰è°çš„æœ‹å‹åå­—ä¸­å«æœ‰â€œä¶®â€å­—çš„ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/28622274)é‡Œæœ‰äººæåˆ°ï¼š

> æœ¬äººæœ‰ä¸¤å¼ å‚¨è“„å¡ï¼Œæ‹›å•†å’Œå·¥å•†ï¼Œæ‹›å•†çš„æˆ·åæ˜¯æŸä¶®ï¼Œå·¥å•†é“¶è¡Œçš„æˆ·åæ˜¯æŸï¼ˆYAN3ï¼‰ï¼Œäº²èº«ç»å†è¯æ˜ï¼šæ‹›å•†å‚¨è“„å¡æ— æ³•å˜æ›´ä¸ºå…¬ç§¯é‡‘è”åå¡ï¼Œä¸»è¦åŸå› æ˜¯å§“åä¸ä¸€è‡´ï¼Œå› æ­¤è‚¯å®šæ²¡æœ‰åŠæ³•æå–å…¬ç§¯é‡‘

ã€€ã€€â€

ã€€ã€€[ä¸€ä¸ªåå­—å«â€œä¶®â€çš„äººçš„è‹¦æ¼ï¼šå¼€ä¸äº†é“¶è¡Œè´¦æˆ·ï¼Œç”¨ä¸äº†å¾®ä¿¡ã€æ”¯ä»˜å®](https://mp.weixin.qq.com/s/1q8Ag21UrEDgRwkqKV41pQ)

> è¿‘æ—¥ï¼Œå¤šä½äººå£«å‘è®°è€…è¡¨ç¤ºï¼Œè‡ªå·±çš„åå­—ä¸­å«æœ‰ â€œä¶®â€ç­‰æ±‰å­—ï¼Œåœ¨åŠç†å…¬ç§¯é‡‘ã€é“¶è¡Œå¡ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜ã€æ‰‹æœºå¡ç­‰é‡‘èã€é€šä¿¡ä¸šåŠ¡æ—¶ï¼Œåå­—æ— æ³•è¢«éªŒè¯ï¼Œå¯¼è‡´ä¸šåŠ¡æ— æ³•åŠç†ã€‚
>
> ç”šè‡³ï¼Œå› ä¸ºæ²¡æ³•ç”³è¯·é“¶è¡Œè´¦æˆ·ï¼Œå¾®ä¿¡ã€æ”¯ä»˜å®ä¹Ÿæ‹’ç»ä½¿ç”¨ï¼Œæœ‰çš„é“¶è¡Œå»ºè®®åå­—å¸¦æœ‰â€œä¶®â€å­—çš„ç”¨æˆ·æ”¹å›ç¹ä½“å­—â€œé¾‘â€ã€‚
>
> ç”Ÿåƒ»å­—å¸¦æ¥é‡‘èäº¤æ˜“ä¸­çš„éº»çƒ¦ï¼Œè¿™ä¸€æƒ…å†µå¹¶ä¸é²œè§ã€‚

ã€€ã€€â€

## æ¼”ç¤º

ã€€ã€€å®è·µå‡ºçœŸçŸ¥ï¼Œæˆ‘ä»¬æ¥æ¼”ç¤ºä¸‹ï¼Œæœ¬æ–‡æ˜¯åœ¨Windowsä¸‹çš„MySQL 5æ¼”ç¤ºã€‚

ã€€ã€€é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†

```java
mysql> create database testunicode default character set utf8 collate utf8_general_ci;
Query OK, 1 row affected (0.00 sec)
```

ã€€ã€€â€

ã€€ã€€åˆ›å»ºå®Œåï¼Œå¯ä»¥æ£€æŸ¥ä¸‹è¯¥æ•°æ®åº“çš„ç¼–ç 

```java
mysql> show create database testunicode;
+------------+--------------------------------------------------------+
| Database    | Create Database                                                      |
+------------+--------------------------------------------------------+
| testunicode | CREATE DATABASE `testunicode` /*!40100 DEFAULT CHARACTER SET utf8 */ |
+-------------+--------------------------------------------------------+
1 row in set (0.00 sec)
```

ã€€ã€€â€

ã€€ã€€ä½¿ç”¨è¯¥æ•°æ®åº“å¹¶åˆ›å»ºè¡¨ï¼Œå¯ä»¥çœ‹åˆ°è¯¥è¡¨çš„é»˜è®¤ç¼–ç æ˜¯UTF8

```java
mysql> use testunicode;
Database changed

mysql> create table t (name varchar(50));
Query OK, 0 rows affected (0.25 sec)

mysql> show create table t
CREATE TABLE `t` (
  `name` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

ã€€ã€€â€

ã€€ã€€å°è¯•insertä¸€ä¸ªemojiï¼Œç¡®å®æœ‰æŠ¥é”™ï¼š

```java
insert into t (name) value('ğŸ˜‚')

SQL é”™è¯¯ [1366] [HY000]: Incorrect string value: '\xF0\x9F\x98\x82' for column 'name' at row 1
```

ã€€ã€€â€

ã€€ã€€æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•æ›´æ¢å­—ç¬¦é›†ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°è¡¨ï¼š

```java
mysql> ALTER DATABASE `testunicode`
DEFAULT CHARACTER SET utf8mb4
DEFAULT COLLATE utf8mb4_bin;

mysql> create table tu (name varchar(50))

mysql> show create table t
CREATE TABLE `t` (
  `name` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

ã€€ã€€â€

ã€€ã€€å°è¯•é‡æ–°insertï¼Œç»“æœæ˜¯èƒ½æˆåŠŸinsertã€‚

```java
mysql> insert into tu (name) value('ğŸ˜‚')
```

## å°ç»“

ã€€ã€€è™½ç„¶ç›®å‰MySQLé»˜è®¤éƒ½æ˜¯ä½¿ç”¨utf8mb4äº†ï¼Œä½†ä¸€äº›æ—©æœŸçš„é¡¹ç›®è¿˜æ˜¯ä½¿ç”¨çš„utf8mb3ï¼Œå¸Œæœ›è¯»è€…ä»¬å¦‚æœé‡åˆ°äº†è¯¥ç¼–ç é—®é¢˜èƒ½æœ‰æ€è·¯ï¼ŒçŸ¥é“æ˜¯æ€ä¹ˆå›äº‹ã€æ€ä¹ˆä¿®å¤ã€‚

ã€€ã€€è§¦ç±»æ—é€šï¼Œå…¶ä»–å…³ç³»å‹æ•°æ®åº“ï¼Œä¾‹å¦‚Oracleç­‰ï¼Œä¹Ÿéœ€è¦è€ƒè™‘ç¼–ç é—®é¢˜

ã€€ã€€â€

## å‚è€ƒ

ã€€ã€€è‹±æ–‡ç‰ˆï¼ˆéœ€ç§‘å­¦ä¸Šç½‘ï¼‰[In MySQL, never use â€œutf8â€. Use â€œutf8mb4â€. | by Adam Hooper | Medium](https://adamhooper.medium.com/in-mysql-never-use-utf8-use-utf8mb4-11761243e434)

ã€€ã€€ä¸­æ–‡ç‰ˆï¼š[è®°ä½ï¼Œæ°¸è¿œä¸è¦åœ¨MySQLä¸­ä½¿ç”¨â€œutf8â€_æ•°æ®åº“_Adam Hooper_InfoQç²¾é€‰æ–‡ç« ](https://www.infoq.cn/article/in-mysql-never-use-utf8-use-utf8)

ã€€ã€€[ä¸€ä¸ªåå­—å«â€œä¶®â€çš„äººçš„è‹¦æ¼ï¼šå¼€ä¸äº†é“¶è¡Œè´¦æˆ·ï¼Œç”¨ä¸äº†å¾®ä¿¡ã€æ”¯ä»˜å®](https://mp.weixin.qq.com/s/1q8Ag21UrEDgRwkqKV41pQ)

ã€€ã€€[æ›å…‰ MySQL çš„ ä¸€ä¸ªå‘ï¼Œä¸è¦å†ä½¿ç”¨ UTF-8 äº†ï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzA4Nzk3ODA0Mg==&mid=2247484205&idx=1&sn=6ab084bfff54fdc344414406a9b2b3cc&chksm=90307a78a747f36e69b41d26bb80c1b89f3349f5d6ef9ab5e4f476988b5510182cb5cc73f674&mpshare=1&scene=1&srcid=0417KfDNE2jl6kk2Tgs7ArKH&sharer_sharetime=1587110729539&sharer_shareid=5cc2777764c85c1d841997739b5bb6f4&key=b1620055a7dc5528f0e65233089854dee199d94b032120819d537f7859f70ea9d066e84fb434fba3b9f06ec36c08b68e17f53aaa1471cb87611c511e8d7a5aa5821a505d607d6d57d6637c49056614c6&ascene=1&uin=MzEzNTMxNzU5NQ%3D%3D&devicetype=Windows+10&version=62080079&lang=zh_CN&exportkey=AXlYHDfOW%2BCvu6ETT1K78vo%3D&pass_ticket=t7u1WU2vv67NzGZQ%2FyXIr6Jgxuqb5IWgSfNRSlR7YzSBGgeYOlooWDMIAtjONqu1)

ã€€ã€€â€

ã€€ã€€