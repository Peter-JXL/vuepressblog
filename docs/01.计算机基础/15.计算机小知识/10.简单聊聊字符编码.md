---
title: 简单聊聊字符编码
date: 2022-12-10 20:47:09
permalink: /literacy/character-encoding/
categories:
  - 计算机基础
  - 计算机小知识
tags:
  - 
---


# 01.简单聊聊字符编码

几乎人人都遇过乱码问题， 程序🐵们更是经常被乱码弄得抓狂，那么乱码产生的原因是什么呢？字符是如何在计算机里存储的呢？本篇文章我们就来聊聊这个主题。

字符编码是计算机世界里最基础、最重要的一个主题之一，请读者们务必掌握。如果不彻底搞懂字符编码，在工作中就容易是不是被其困扰，本人花费了一两周时间才稍稍入门，在工作中算是够用了。

字符编码的基础性、重要性，主要体现在它涉及面广。向下涉及到计算机的底层技术，甚至是硬件实现；向上几乎跟所有的操作系统、编程语言、应用程序都密切相关。

　　‍![](https://image.peterjxl.com/blog/01.字符编码-20221210172453-be3bpal.jpg)

<!-- more -->

## 前言

　　本文首先介绍什么是字符编码，以及常见的字符编码，意在使读者对字符编码有基本的认知

　　学习之前，读者应具有基本的数字电路或计算机组成原理的知识，知道什么是二进制、位、字符和内存等，如果有相关的编程基础就更好了。

　　为了照顾部分读者，我们还是简单复习下吧：

* 什么是位：位是数据存储的最小单位，一个位存储一个二进制数，要么是0，要么是1
* 什么是字节：8个位构成一个字节
* 什么是字符：简单来说，字符就是各国所使用的文字。例如26个英文字母是字符，中国的几万个汉字也是字符，同理还有日文、法文等。
* 特别注意："字符"和"字节" 是两个不同的概念，“字节”是一个8位的物理存储单元，而“字符”则是一个文化相关的符号。
* 什么是编码：请参考 [编码与原码、补码、反码](https://www.peterjxl.com/ComputerDigital/2-code/#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BF%A1%E6%81%AF) ，介绍并讲述了数字在计算机中是如何保存和计算的，也就是以补码的形式存储和计算。
* 什么是字符编码：表示字符在计算机中是如何存储的。

　　‍

　　为什么我们需要字符编码？因为人们发现计算机可以做很多很多事情，不仅仅可以用来计算，还可以用来显示字符，打印字符（例如电子邮件，打印机，网站等，都需要显示和处理字符）。但计算机只能保存0和1，字符是如何保存的呢？

　　‍

## ASCII编码

　　1967 年美国发布了一套字符编码：ASCII（全称American Standard Code for Information Interchange，美国信息互换标准代码）。特点如下：

* 用一个字节来存储一个字符（最高位统一是0，只用了剩下的7位来表示字符。2^7   ​^=128）
* 共收录了128个字符，分别如下：

  * 基本的英文字母（从abcd到……xyz）
  * 阿拉伯数字（0123456789），
  * 标点符号（逗号句号等）、
  * 特殊符号（感叹号、@，井号等）
  * 一些带有控制功能的字符（例如换行符，回车符）。

　　举个丽子，空格“space”的编码是32（0B00100000），字母A的编码是65（0B01000001）。当我们告诉计算机某个内存单元是字符的时候，计算机会根据ASCII码  查表，然后知道是这是什么字符，并处理该字符（例如显示在显示器上）

　　咱们不一一说明所有ASCII码，那不是本章的主题；完整的ASCII请参考下一篇文章。
　　‍

## 只有ASCII编码足够吗？

　　由于计算机最初是西方发明的，因此只考虑了英文字符的情况。

　　随着计算机的普及，全球各地都开始用计算机了，并且各国也想在计算机上展示、处理本国的字符。

　　例如中国，就有很多很多汉字，法语中，字母上方还有注音符号，这些字符，肯定都不能用ASCII码表示的。怎么办呢？

　　很简单，各国再搞一个编码...........

　　‍

　　‍

　　‍

## GB2312编码

　　即使用上ASCII的最高位，也才256个编码；而常用的汉字就有几千个了，一个字节肯定是不够用的，因此得用多个字节。

　　在1980年，中国发布了GB2312编码，特点如下：

* GB2312 使用2个字节来存储一个字符
* GB2312  是对 ASCII 的中文扩展。小于127的字符意义与原来相同，这样ASCII码原来的字母和标点符号都还保留了；
* 两个大于127的字符连在一起的时候，就表示一个汉字。
* ASCII里原有的数字、标点符号和字母也重新编码（用两个字节表示） ，这样得到的符号是全角符号。而127以下的的就是半角符号。
* 为什么会有全角符号？比如中国的逗号和西方的一些标点符号是不同的，例如逗号和感叹号。你可以分别在全角和半角模式下输入逗号和感叹号，观察他们的不同：中文情况下：`，！`​​  英文：`,!`​​

　　GB2312一共收录了7445个常用汉字，包括6763个汉字和682个其它符号，足够人们日常使用。

　　为什么说是对ASCII的中文扩展？因为这种编码格式是兼容ASCII的。即使用GB2312的方式打开ASCII编码的文档，也不会乱码。

> 注意，此时对于编程而言，一个汉字算两个英文字符 （一个汉字两个字节，能存储2个英文字符）

　　‍

　　‍

　　‍

## GBK编码

　　中国的汉字实在是太多了，一些人名和生僻字，都无法用GB2312编码打出来。因此，在1995年，中国发布了GBK编码。特点如下：

* GBK编码不再要求低字节一定是大于127，只要第一个字节大于127就表示是一个汉字的开始；
* GBK包含了GB2312的所有内容，同时新增了近20000个新的汉字（繁体字）和符号

　　‍

　　‍

　　‍

## GB18030编码

　　后来，少数民族也要用电脑了，怎么办呢？再次扩展字符编码……

　　在2000年，GB18030编码发布了，取代了GBK编码成为正式的国家标准。

　　该标准收录了27484个汉字，同时还收录了藏文、蒙文、维吾尔文等主要的少数民族文字。现在的PC平台必须支持GB18030，对嵌入式产品暂不作要求。所以手机、MP3一般只支持GB2312。 

　　‍

## 中文编码小结

　　从ASCII、GB2312、GBK到GB18030，这些编码方法是向下兼容的，即同一个字符在这些方案中总是有相同的编码，后面的标准支持更多的字符。在这些编码中，英文和中文可以统一地处理。

　　区分中文编码的方法是高字节的最高位不为0。

　　按照程序员的称呼，GB2312、GBK到GB18030都属于双字节字符集 (Double Byte Charecter Set，简称DBCS )。

这里附上一个示意图

  ![](https://image.peterjxl.com//blog/GB%E7%B1%BB%E7%BC%96%E7%A0%81%E5%85%B3%E7%B3%BB.jpg)
　　‍
感兴趣的同学可以去[国家标准全文公开系统](https://openstd.samr.gov.cn/bzgk/gb/newGbInfo?hcno=C344D8D120B341A8DD328954A9B27A99)去查看更多信息。
　　‍

　　‍

　　‍

## ANSI编码

　　ANSI全称American National Standard Institite，是美国国家标准学会（美国的一个非营利组织）指出的概念。

　　ANSI不是指的一种特定的编码，而是不同地区扩展编码方式的统称，各个国家和地区所独立制定的兼容ASCII编码，但互相不兼容的字符编码，微软统称为**ANSI编码。**例如，

* GB2312，GBK就是兼容ASCII编码的，是对ASCII的扩展
* BIG5码，是通行于台湾、香港地区的一个繁体字编码方案，俗称“大五码”，也兼容ASCII的编码
* 日本则提出了SHIFT_JIS编码，也是对ASCII的扩展
* 韩国把韩文编到Euc-kr里

　　以上这些各个国家为了兼容而提出的编码，统称ANSI编码。

　　我们可以这样总结：ANSI编码用0x00–0x7f （即十进制下的0到127）范围的1 个字节来表示 1 个英文字符，超出一个字节的 0x80~0xFFFF 范围来表示其他语言的其他字符。

　　换句话说：ANSI的前128个字符与ASCII码相同，之后的字符全是某个国家语言的所有字符，但各国有各国的标准，这些编码之间不能相互转换。

　　‍

　　‍
## 字符集的概念

一套编码能表示的所有字符和标点符号，我们称之为字符集，是一个自然语言系统中各种文字和符号的总称，含文字，数字，字母，标点符号，音节，图形符号等。例如中文就是一个字符集，汉字有10w个左右，除此之外还有拼音符号等；有的国家的语言还有音节，这里不一一展开。

可以将字符集理解为一个很大的表格，列出了字符和二进制的关系，计算机显示文字或者存储文字，就是一个查表的过程。例如ASCII的部分对照表：


| 二进制   | 十进制 | 字符/缩写 |
| ---------- | -------- | ----------- |
| 01000001 | 65     | A         |
| 01000010 | 66     | B         |
| 01000011 | 67     | C         |
| 01000100 | 68     | D         |
| 01000101 | 69     | E         |
| 01000110 | 70     | F         |
| 01000111 | 71     | G         |
　　‍

　　‍在继续讲下去之前，我们先复习一下编码的概念：编码就是将信息转换为另一种格式或形式，例如将字符转为二进制的数字；解码就是编码的逆过程。可以参考：[编码与原码、补码、反码](https://www.peterjxl.com/ComputerDigital/2-code/)

字符编码，就是将字符集中的字符，根据一定的格式编码为某指定集合中的某一对象（例如将字符‘A’ 转为 0和1组成的位串这个集合 中的01000001 ）。可以理解为在字符集 和 指定集合之间建立一个对应关系（也叫映射关系）的过程，将字符编码为一串二进制数。

常见的例子还有摩斯电码，也是一种字符编码。

## 当编码方案多了起来……

　　因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码。这有什么缺点呢？

* 比如大陆用的是GBK编码，保存了一个文本文件；而台湾用的是BIG5编码，打开GBK编码的文件的时候，就会乱码。
* 在电子邮件中，也常常出现乱码，就是因为发信人和收信人的编码不一样。

　　‍

　　相信大家平时多多少少也遇到过乱码的问题吧！这就是其原理。这就是标准不统一带来的问题。堪称计算机的巴比伦塔命题。

　　‍

> 巴别塔是《圣经·旧约·创世记》第11章故事中人们建造的塔。根据篇章记载，当时人类联合起来兴建希望能通往天堂的高塔；为了阻止人类的计划，上帝让人类说不同的语言，使人类相互之间不能沟通，计划因此失败，人类自此各散东西。此事件，为世上出现不同语言和种族提供解释。----来自百度百科

　　‍

　　‍

　　‍

　　‍

## Unicode

　　为了统一标准，ISO （国际标谁化组织）开始制定一套新的规范，其目的是要在一套字符集内，囊括地球上所有文化、所有字母和符号！并且不兼容所有的地区性编码（例如GBK和BIG5，但兼容ASCII），这样，乱码问题就会消失。

　　这套编码的名字为"Universal Multiple-Octet Coded Character Set"，简称 UCS,   但一般称为 "UNICODE"。 特点如下：

* Unicode 只是一个字符集，给出了字符的编号；但制定的时候，并没有考虑编码的问题（例如用几个字节存储，怎么编码）
* 可以使用多个字节来存储一个字符，例如2个，3个和4个字节。 （UNICODE 开始制订时，计算机的存储器容量极大地发展了，空间再也不成为问题了）

　　‍

　　例如，实现Unicode的编码有这几种：

* UCS-2（2个字节存储一个字符）
* UCS-4（4个字节存储一个字符）
* UTF - 8 （变长字节，可以用1~4个字节来存储一个字符）,
* UTF - 32（固定使用4个字节）
* UTF - 16：介于 UTF-8 和 UTF-32 之间，使用 2 个或者 4 个字节来存储，长度既固定又可变

　　4个字节表示一个字符的话，我们就可以组合出21亿个不同的字符出来（最高位有其他用途），这应该够用到银河联邦成立吧……

　　此时不管是英文字母还是中文字母，都只算做一个符号。再次提醒："字符"和"字节"两个术语的不同，“字节”是一个8位的物理存储单元，而“字符”则是一个文化相关的符号。

> UTF，是Unicode Transformation Format的缩写，意为把 Unicode 字符转换为某种格式。UTF 系列编码方案（UTF-8、UTF-16、UTF-32）均是由 Unicode 编码方案衍变而来，以适应不同的数据存储或传递。
>
> 换句话说，UTF8，UTF16和UTF32都是Unicode的实现，可以理解为将某个具体的Unicode字符，转为具体的某种格式（例如3个字节存储的格式，4个字节存储的格式）
>
> 一般来说，Unicode编码之间可以相互转换，例如UTF8可以转换为UTF16.
>
> 在计算机内存中，统一使用Unicode编码，当需要保存到硬盘或者需要传输的时候，就转换为UTF-8编码。用记事本编辑的时候，从文件读取的UTF-8字符被转换为Unicode字符到内存里，编辑完成后，保存的时候再把Unicode转换为UTF-8保存到文件。

　　‍

使用Unicode有什么好处呢？

1. 乱码问题得以解决，目前最常用的编码是UTF8，UTF16也比较常用，基本上所有系统都支持Unicode。
2. 对于一些多语言的软件，例如操作系统，邮件系统，都不用为字符集头疼了。从Windows NT 开始，MS 趁机把它们的操作系统改了一遍，把所有的核心代码都改成了用 UNICODE 方式工作的版本，从这时开始，WINDOWS 系统终于无需要加装各种本土语言系统，就可以显示全世界上所有文化的字符了。
3. 对于网络上传输字符也很方便，只需用UTF的标准来传输就完事。

## 为什么有变长的编码格式

　　先说结论：节省存储空间。

　　举个粒子，Unicode常用多个字节来存储一个字符，但一个英文字符只用一个字节来存储就够了，如果用多个字节，多浪费啊！此时我们可以只用一个字节就可以存储英文，但其他的字符就用多个字节。

　　后面我们再具体来说Unicode的机制。本篇我们只是简单介绍下编码。

　　‍

　　‍

## 实践

　　我们来简单试试字符编码吧！以加深读者们对编码的认识，也请读者跟着笔者一起动手实践。

　　我们以Windows为例，Mac和Linux操作也是类似的。

　　我们打开记事本，里面输入HelloWorld，然后保存

　　​![image](https://image.peterjxl.com/blog/image-20221210194352-lky8qs7.png)​

　　可以看到，默认是UTF8编码，我们修改为ASCII编码（ANSI）

　　‍

　　然后，我们打开文件属性，可以看到是10个字节，因为我们存储的是10个字符：

　　​![image](https://image.peterjxl.com/blog/image-20221210193953-u026hja.png)​

　　‍

　　打开文件，也能看到是ANSI格式

　　​![image](https://image.peterjxl.com/blog/image-20221210194231-jbg0uhv.png)

　　‍

　　‍

　　‍

　　‍

## 转换格式

由于Windows自带的记事本，暂不支持文件格式的转换，因此，我们得用第三方的文本编辑器（可以理解为高级一点、功能更多的记事本），这里以VSCode为例，我们用VSCode打开该文件，然后删除全部内容。（其他小伙伴也可以用notepad++，Sublime，notepad3等其他编辑器，甚至IDE都可以完成 一样的操作。）

　　然后点击编码，选择通过GB2312保存，结果如下：

　　​![image](https://image.peterjxl.com/blog/image-20221210194820-u7slpcv.png)​

　　‍

　　然后我们输入你好，世界   可以看到占用了10个字节（一个汉字两个字节，包括中文逗号）

　　​![image](https://image.peterjxl.com/blog/image-20221210195017-gkxm8aq.png)​

　　‍

　　同理，我们试着用UTF8保存，可以看到占用15个字节了

　　​![image](https://image.peterjxl.com/blog/image-20221210195216-d5ry274.png)​

　　‍

　　‍

　　‍

## Linux下关于编码的一些操作

　　在Linux下如何查看一个文件的编码？可以用file命令。比如我们上传刚刚的HelloWorld.txt到服务器上：

```shell
$ file HelloWorld.txt 
HelloWorld.txt: UTF-8 Unicode text, with no line terminators
```

　　‍

　　‍

　　用vim查看编码：在命令模式下输入 一下命令

```vim
:set fileencoding
```

　　​![image](https://image.peterjxl.com/blog/image-20221210195714-5wtqfx7.png)​

　　‍

　　‍

　　用vim转换编码：在命令行里输入

```vim
:set fileencoding=utf-8
```

　　​​

　　‍在Linux下，还有一个专门用来处理编码的工具：enca，感兴趣的读者可以去搜索下相关介绍。

　　‍

## 小结

　　什么是字符：字符就是一个文字的符号，例如汉字，例如英文字幕

　　什么是字符编码：告诉计算机如何保存与处理字符的机制。

　　常见的字符编码：

* ASCII
* ANSI编码
* UTF编码
  
这里附上一个示意图

　　‍![](https://image.peterjxl.com//blog/character-encoding-show.jpg)

## 参考

　　网上的文章大多讲的比较零散，稍微有点乱，因此本人在学习的时候将这些知识点整理了下，非常感谢以下博客：

　　‍[字符编码笔记：ASCII，Unicode 和 UTF-8](https://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)

　　[Unicode介绍_无声蝉的博客-CSDN博客_unicode简介](https://blog.csdn.net/zhuxipan1990/article/details/51602299)

　　[编码方式之ASCII、ANSI、Unicode概述 - 蓝海人 - 博客园](https://www.cnblogs.com/lanhaicode/p/11214827.html)

　　[VC_字体编码格式_ASCII、Unicode、UTF-8、UTF-16、UCS、BOM、Endian_yangtalent1206的博客-CSDN博客_vc字符编码](https://blog.csdn.net/yangtalent1206/article/details/7588672)
