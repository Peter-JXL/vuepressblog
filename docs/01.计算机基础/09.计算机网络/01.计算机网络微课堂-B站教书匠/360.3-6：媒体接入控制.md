---
title: 3-6 媒体接入控制的基本概念
date: 2023-11-16 15:49:52
permalink: /Network/data-link-layer/3.6
categories:
  - 计算机基础
  - 计算机网络
  - 计算机网络微课堂-B站教书匠
tags:
  - 
feed:
  enable: true
description: 本节课我们介绍媒体接入控制的基本概念
---


# 360.3-6 媒体接入控制

本节课我们介绍媒体接入控制的基本概念。
<!-- more -->

‍

## 3.6.1 媒体接入控制的基本概念

如图所示，这是一根同轴电缆，有多台主机连接到这根同轴电缆上，他们共享这跟传输媒体‍‍，形成了一个总线型的局域网。

​![](https://image.peterjxl.com/blog/image-20240523165805-jiwrq5x.png)​

各主机竞争使用总线，随机的在信道上发送数据，如果恰巧有两个‍‍或更多的站点在同一时刻发送数据，那么信号在共享媒体上就要产生碰撞，即发生了冲突，‍‍使得这些站点的发送都失败。例如主机 C 和主机 D 同时使用总线来发送数据，‍‍这必然会产生所发送信号的碰撞。‍‍

共享信道要着重考虑的一个问题就是‍‍如何协调多个发送和接收站点，对一个共享传输媒体的占用，也就是媒体接入控制 MAC‍‍，也可以读作 Mark。

‍

媒体接入控制技术主要分为两类，一类是静态划分信道，‍‍另一类是动态接入控制：

* 静态划分信道主要有频分多址，时分多值‍‍以及码分多值
* 动态接入控制又可以分为两类，一类是受控接入，另一类是随机接入。‍‍而受控接入又可分为集中控制和分散控制

‍

​![](https://image.peterjxl.com/blog/image-20211212162416-m2xwgjq.png)​

‍

静态划分信道，也就是预先固定分配好信道，这类方法非常不灵活，对于突发性数据传输，‍‍信道利用率会很低，通常在无线网络的物理层中使用，而不是在数据链路层中使用。‍‍

在集中控制的多点轮巡协议中，有一个主站，以循环方式轮巡每个站点有无数据发送，‍‍只有被轮循到的站点才能发送数据。集中控制的最大缺点就是存在单点故障问题，‍‍

而在分散控制的令牌传递协议中，各站点是平等的并连接成一个环形网络‍‍，令牌也就是一种特殊的控制针，延环逐站传递，接收到令牌的站点才有权发送数据，‍‍并且在发送完数据后将令牌传递给下一个站点。

需要说明的是‍‍采用令牌传递协议的典型网络有 IEEE 802.5 令牌环网，IEEE 802.4 令牌总线网，‍‍光纤分布式数据接口 FDDI。这些网络由于市场竞争已逐步退出了历史舞台，

‍

随机接入的特点是所有站点通过竞争‍‍，随机的在信道上发送数据，如果恰巧有两个或更多的站点在同一时刻发送数据，‍‍那么信号在共享媒体上就要产生碰撞，即发生了冲突，使得这些站点的发送都失败。‍‍因此‍‍这类协议要解决的关键问题是如何尽量避免冲突，以及在发生冲突后如何尽快恢复通信。

‍

**著名的共享式以太网采用的就是随机接入**，需要注意的是随着技术的发展，‍‍交换技术的成熟和成本的降低，具有更高性能的使用点对点链路‍‍和链路层交换机的交换式局域网，在有线领域已完全取代了共享式局域网，‍‍但由于无线信道的广播天性，无线局域网仍然使用的是共享媒体技术

‍

‍

‍

## 3.6.2 媒体接入控制-静态划分信道

本节课我们介绍媒体接入控制的其中一类方法，‍‍也就是静态划分信道。

我们首先介绍信道复用的基本概念，复用是通信技术中的一个重要概念，‍‍也就是通过一条物理线路同时传输多路用户的信号。‍‍当网络中传输媒体的传输容量‍‍大于多条单一性到传输的总通信量时，可利用复用技术在一条物理线路上‍‍建立多条通信信道，来充分利用传输媒体的带宽，‍‍如图所示，这是三对用户各自使用一条独立的物理线路进行通信，如果在发送端‍‍使用复用器，在接收端在使用分用器，这三段用户就可以共享一条物理线路进行通信。‍‍

​![](https://image.peterjxl.com/blog/image-20211212162613-8tcyd09.png)​

‍

常见的信道复用技术有频分复用 FDM，时分复用 TDM，波分复用 WDM，‍‍码分复用 CDM。

#### 频分复用

首先来看频分复用，如图所示将传输线路的平台资源‍‍划分成多个子频带，形成多个子信道，各子信道之间需要留出隔离频 1 带，‍‍以免造成子信道间的干扰。‍‍

当多路信号输入一个多路复用器时，这个复用器‍‍将每一路信号调制到不同频率的载波上，接收端由相应的分用器通过滤波，将各路信号分开，‍‍将合成的复用信号恢复成原始的多路信号。

很显然频分复用的所有用户‍‍同时占用不同的频带资源并行通信。

​![](https://image.peterjxl.com/blog/image-20211212201500-4pvpsoa.png)​

‍

‍

#### 时分复用

再来看时分复用。‍‍如图所示，横坐标为时间，将时间划分成一个个的时隙，时分复用技术将传输线路的带宽资源按时隙轮流分配给不同的用户，每对用户只在所分配时隙里‍‍使用线路传输数据。

时分复用技术，将时间划分成了一段段等长的时分复用帧，每一个时分复用的用户，在每一个时分复用帧中占用固定序号的时隙。‍‍如图所示，‍‍每一个用户所占用的时隙是周期性出现的，‍‍其周期就是时分复用帧的长度，很显然时分复用的所有用户‍‍在不同的时间占用同样的频带宽度。‍‍

​![](https://image.peterjxl.com/blog/image-20211212201412-15o9r6m.png)​

‍

#### 波分复用

再来看波分复用，波分复用其实就是光的频分复用，‍‍如图所示：

​![](https://image.peterjxl.com/blog/image-20211212201551-1p5scoh.png)​

‍

这是 8 路传输速率均为 2.5g 比特每秒的光载波，其波长均为 1310 纳米，‍‍经光调制后分别将波长变换到 1550~1561.2 纳米，‍‍每个光载波相隔 1.6 纳米，这 8 个波长很接近的光载波，经过光复用器，‍‍或称合波器就在一根光纤中传输，因此在一根光纤上数据传输的总速率‍‍就达到了 8 * 2.5g 比特每秒，也就等于 20g 比特每秒，光信号传输一段距离后会衰减，‍‍因此对衰减了的光信号必须进行放大，才能继续传输。‍‍

现在已经有了很好的掺铒光纤放大器，两个光纤放大器之间的光缆线路长度可达 120 公里，‍‍而光复用器和光分用器或称分拨器‍‍之间可以放入 4 个掺铒光纤放大器，使得光复用器和光分用器之间的无光电转换的距离‍‍可达 600 公里。‍‍

‍

#### 码分复用

再来看码分复用，码分复用是另一种共享信道的方法，实际上‍‍由于该技术主要用于多址接入，人们更常用的名词是码分多址 CDMA。同理频分复用‍‍和时分复用，同样可用于多址接入，相应的名词是频分多址 FDMA 和 时分多址 TDMA。

在本课程中，我们不严格区分复用与多址的概念。可简单理解如下：复用是将单一媒体的平台资源划分成很多子信道，‍‍这些子信道之间相互独立，互不干扰。‍‍从媒体的整体平台资源上看，‍‍每个子信道只占用该媒体平台资源的一部分，多址更确切的应该成为多点接入，‍‍他处理的是动态分配信道给用户，这在用户仅仅暂时性的占用信道的应用中是必须的，‍‍而所有的移动通信系统基本上都属于这种情况。

相反，在信道永久性的分配给用户的应用中，‍‍多址是不需要的，例如对于无线电广播或电视广播就是这样。‍‍某种程度上‍‍平分多址，时分多址，码分多址，可以分别看成是频分复用，时分复用，码分复用的应用‍‍。

​![](https://image.peterjxl.com/blog/image-20211221214511-v8sq3ys.png)​

‍

‍

‍

与频分复用和时分复用不同，‍‍码分复用的每一个用户可以在同样的时间使用同样的频带进行通信。‍‍由于各用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。‍‍码分复用最初是用于军事通信的，因为这种系统所发送的信号有很强的抗干扰能力，‍‍其频谱类似于白噪声，不易被敌人发现。‍‍随着技术进步，码分多址设备的价格和体积‍‍都大幅度下降，因而现在已广泛用于民用的移动通信。

在码分多址中，‍‍每一个比特时间再划分为 m 个短的间隔，称为码片，‍‍通常 m 的值是 64 或 128。

为了简单起见，在后续的举例中，我们假设 M 为 8‍‍。在使用码分多址的每一个站，被指派一个唯一的 m 比特码片序列，一个站如果要发送比特 1，‍‍则发送他自己的 m 比特码片序列。一个站如果要发送比特 0，‍‍则发送他自己的 m 比特码片序列的二进制反码。‍‍我们来举例说明，‍‍假设只派给码分多址系统中某个站点的码片序列为 0001 1011 该站发送比特 1，就是发送自己的码片序列 0001 1011。该站发送比特 0，就是发送自己的码片序列的二进制反码 1110 0100。

为了方便，‍‍我们按惯例将码片序列中的 0 写为-1，1 写为正 1，则该站点的马片序列是-1‍‍， -1，-1、+1、  +1、+1、-1、‍‍+1。顺便提一下，这种通信方式称为直接序列扩频 DSSS。码片序列的挑选原则如下：

* 第一，分配给每个站的码片序列，必须各不相同，‍‍实际常采用每随机码序列。
* 第二，分配给每个站的码片序列，必须相互正交，‍‍也就是规格化内积为零。

零向量 s 表示占 s 的码片序列，向量 t‍‍ 表示其他任何站的码片序列，两个不同站 s 和 t 的码片序列正交，‍‍就是向量 s 和 t 的规格化内积为 0，可写为如下的表达式，向量 s 和 t 的规格化内积为 0，‍‍就是将向量 s 和 t 中对应分量相乘，然后相加再除以向量中分量的数量，‍‍其结果为 0。‍‍

那么请大家思考一下，任何一个码片向量‍‍和该码片向量自己的规格化内机是多少？很显然应该是一。‍‍不仅如此，任何一个码片向量和其他各占码片反码的向量的内机也是 0，‍‍任何一个码片向量和该码片反码的向量的内积是-1。

​![](https://image.peterjxl.com/blog/image-20211221215048-cmzois4.png)​

‍

‍

接下来我们来做一个练习，‍‍假设给站 s 的分配的码片序列为 01011101，给站 t 分配的码片序列为 1011 1000，这样的分配正确吗？

首先检查码片序列是否各不相同，很显然‍‍题目所给的两个码片序列互不相同，满足码片序列挑选原则的第一条。‍‍

再来检查码片序列是否相互正交。根据题意可知，用向量 s 表示站 s 的满屏序列为‍‍-1，+1 ，-1，+1，+1， +1，-1，+1，用向量 t‍‍ 表示站 t 的码片序列为+1，-1，+1，+1，+1，+1，+1，-1，‍‍向量 s 和 t 的规格化内积计算如下，结果不等于 0，‍‍不满足码片序列挑选原则的第二条。

​![](https://image.peterjxl.com/blog/image-20211221215147-20uggch.png)​

‍

接下来我们来看码分多指的应用举例，假设 ABCD‍‍ 是码分多址系统中的 4 个站点，A 站发送比特一，也就是发送自己所分配到的码片序列。‍‍为了简单起见，我们用向量 A 来表示 A 站的码片序列，B 站发送比特 0，‍‍也就是发送自己所分配到的码片序列的二进制反码。我们用 B 法‍‍来表示 B 站的马片序列的二进制砝码。C 站没有发送数据，显然‍‍ D 站可以接收到 A 站和 B 站所发送信号的叠加信号。‍‍

假设系统中的各站‍‍所发送的码片序列都是同步的，接收站 D，知道其他各站点或特有的码片序列，则接收站 D 对所接收到的叠加信号可以进行判断，要判断 A 站是否发送数据，‍‍所发送的是比特 0 还是比特 1，可将收到的叠加信号的码片向量与 A  站自身的码片向量‍‍进行规格化内机运算。‍‍根据我们之前就给出过的参考公式和计算出结果为 1。‍‍

同理，要判断 B 站和将收到的叠加信号的码片向量与 B 站自身的码片向量‍‍进行规格化内机运算，可计算出结果为-1。

要判断 c 站可将收到的叠加信号的码片向量‍‍与 C 站自身的满屏向量进行规格化内积运算，可计算出结果为 0。‍‍

从上述计算结果可以看出，计算结果为数值 1，被判断方发送了比特 1，‍‍计算结果为数值 -1，被判断方发送了比特 0，‍‍计算结果为数值 0，被判断方未发送数据。

​![](https://image.peterjxl.com/blog/image-20211221215328-iw4942o.png)​

‍

我们基于上述方法来做一个练习，‍‍已知 4 个站各自的码片序列以及接收到的码片序列，那么哪些站发送了数据？‍‍发送的是比特 1 还是 0？‍‍我们一起来分析一下，用收到的码片序列‍‍分别与各站的码片序列进行求规格化内积的运算：

* 若计算结果为数值 1 则被判断的站发送了比特 1，‍‍若计算结果为数值-1，则被判断的站发送了比特 0
* 若计算结果为数值 0，‍‍则被判断的站未发送数据

判断 A 站：用 A 站的码片序列与收到的码片序列‍‍进行求规格化内积的运算，结果为 1，因此可知 A 站发送了比特 1

判断 B 站：用 B 站的码片序列与收到的码片序列进行求规格化内积的运算，结果为 -1。‍‍因此可知‍‍ B 站发送了比特 0

判断 C 站：用 C 站的码片序列‍‍与收到的码片序列进行求规格化内积的运算，结果为 0。‍‍因此可知 C 站没有发送数据

判断 D 站：用 D 站的码片序列与收到的码片序列进行求规格化内机的运算，结果为 1，‍‍因此可知 D 站发送了比特 1

​![](https://image.peterjxl.com/blog/image-20211221215434-pp4cuyf.png)​

​![](https://image.peterjxl.com/blog/image-20211221215444-4g9etc3.png)​

​![](https://image.peterjxl.com/blog/image-20211221215502-broqfbx.png)​

​![](https://image.peterjxl.com/blog/image-20211221215517-7e7vvoo.png)​

​![](https://image.peterjxl.com/blog/image-20211221215537-46169to.png)​

‍

最后请同学们自己来完成一个练习。‍‍这是计算机专业考研‍‍全国统考，计算机网络部分 2014 年的题 37，答案是选项 B。

​![](https://image.peterjxl.com/blog/image-20211221215701-n7cub4x.png)​

我们一起来分析一下，‍‍由于题目所给各站的码片序列为 4 位，因此将站点 c 收到的序列分成 3 部分，‍‍每部分也由 4 位构成，如下所示。将站点 A 的码片序列分别与上述三个部分‍‍进行规格化内积运算。‍‍

* 根据计算结果，就可以判断出站点 A 所发送的数据，‍‍将站点 A 的码片序列与第一部分码片序列进行规格化内积运算，结果是一，‍‍因此可知站点 A 所发送的第一个数据是比特 1
* 将站点 A 的码片序列‍‍与第二部分码片序列进行规格化内机运算，结果是-1。因此可知‍‍站点 A 所发送的第二个数据是比特 0
* 将站点 A 的码片序列与第三部分码片序列‍‍进行规格化内机运算，结果是 1，因此可知站点 A 所发送的第三个数据是比特 1

综上所述，选项 B 正确

‍

‍

本节课的内容小结如下：

​![](https://image.peterjxl.com/blog/image-20211221215714-aij7cxy.png)​

‍

## 3.6.3 随机接入 CSMACD 协议

‍

在上节课中我们介绍了媒体接入控制的其中一类方式，也就是静态化分信道。本节课我们介绍随机接入，它属于媒体接入控制的另一类方式，即动态接入控制，如图所示多个主机连接到一根总线上，各主机随机发送帧。

当两个或多个主机同时发送帧时，代表帧的信号就会产生碰撞或称为冲突，又或者当某个主机正在使用总线发送帧的过程中，另一台主机也要发送帧，这同样也会产生碰撞。

很显然如何协调总线上各主机的工作尽量避免产生碰撞，是一个必须要解决的重要问题。早期的共享式以太网采用载波监听/多址接入碰撞检测，也就是 CSMA/CD 协议来解决该问题。

​![](https://image.peterjxl.com/blog/image-20211221220918-cgwzcc6.png)​

‍

---

首先来看多址接入，多址接入的意思是多个主机也可称为站点或站连接在一条总线上，竞争使用总线。

再来看载波监听，载波监听的意思是每一个站在发送帧之前，先要检测一下总线上是否有其他站点在发送帧，可比喻为先听后说，若检测到总线空闲 96 比特时间则发送这个帧，若检测到总线忙，则继续检测并等待总线转为空闲 96 比特时间，然后发送帧。96 比特时间是指发送 96 比特所耗费的时间，也称为帧间最小间隔，其作用是接收方可以检测出一个帧的结束，同时也使得所有其他站点都能有机会平等竞争性到并发送帧。

再来看碰撞检测，碰撞检测的意思是每一个正在发送帧的站，边发送帧边检测碰撞，可比喻为边说边听，一旦发现总线上出现碰撞，则立即停止发送，退避一段随机时间后再次重新发送，可比喻为一旦冲突，立即停说，等待时机重新再说。

​![](https://image.peterjxl.com/blog/image-20211221221111-1875drl.png)​

‍

---

下面我们来举例说明，多址接入，载波监听以及碰撞检测。多址接入的概念比较简单，即多个主机连接到一根总线上，各主机随机发送帧，假设主机 C 要发送帧，它首先进行载波监听，检测到总线空闲 96 比特时间后就可以发送帧了。假设在主机 C 使用总线发送帧的过程中，主机 B 也要发送帧，主机 B 进行载波监听，发现总线忙，于是持续检测总线，一旦发现总线空闲 96 比特时间，则立即发送帧，边发送帧还要边检测碰撞，只要没检测到碰撞，则可继续发送帧的剩余部分。

假设在主机 B 发送帧的过程中，主机 C 也要发送帧，主机 C 进行再不监听，发现总线空闲 96 比特时间后立即发送帧，这必然会产生碰撞。在产生碰撞的时刻，主机 B 和主机 C 都在边发送帧边检测碰撞，但都检测不到碰撞，碰撞信号沿总线传播，主机 C 会比主机 B 更早检测到碰撞并停止发送。

退避一段随机时间后，重新再发送之前所发送的帧。当主机 B 检测到碰撞后，立即停止发送，退避一段随机时间，重新再发送之前所发送的帧。以太网还采取了一种叫做强化碰撞的措施，这就是当发送帧的站点，一旦检测到碰撞，除了立即停止发送帧外，还要再继续发送 32 比特或 48 比特的人为干扰信号，以便有足够多的碰撞信号，使所有站点都能检测出碰撞。

​![](https://image.peterjxl.com/blog/image-20211221221253-nnwu25d.png)​

‍

---

接下来我们介绍争用期的概念，如图所示主机 A 和 D 处于总线型以太网的两端，以太网单程端到端的传播时延即为 T，纵坐标为时间，假设在时刻 0 主机 A 要发送帧，当检测到总线空闲 96 比特时间后，立即发送帧，在时刻 T-A，主机 D 也要发送帧，当检测到总线空闲 96 比特时间后，立即发送帧，需要注意的是主机 D 检测到总线空闲，但实际上总线并不空闲，只是主机 D 检测不出来，这必然会产生碰撞，发生碰撞的时刻为 T 减去 A/2。之后，碰撞信号会陆续传播到主机 D 和主机 A。主机 D 检测到碰撞的时刻为 A，而主机 A 检测到碰撞的时刻为 2T 减去 A。从该图可知，主机最多经过 2T，也就是 A 趋近于 0，就可检测到本次发送是否遭受了碰撞。

因此以太网的端到端往返传播实验 2T，就称为争用期或碰撞窗口，发送帧的主机，经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会产生碰撞。

每一个主机在自己发送帧之后的一小段时间内，存在着遭遇碰撞的可能性，这一小段时间是不确定的，它取决于另一个发送帧的主机到本主机的距离，但不会超过总线的端到端往返传播时延，即一个争用期时间，显然在以太网中发送帧的主机越多，端到端往返传播时间越大，发送碰撞的概率就越大。

因此共享式以太网不能连接太多的主机，使用的总线也不能太长，带宽为 10 兆比特每秒的以太网，把争用期定为 512 比特，发送时间即 51.2 微秒，因此其总线长度不能超过 5120 米。但考虑到其他一些因素，如信号衰减等，以太网规定总线长度不能超过 2500 米。

​![](https://image.peterjxl.com/blog/image-20211221221608-qrnwypz.png)​

‍

---

接下来我们介绍最小帧长的概念。

假设主机 A 正在给主机 D 发送一个很短的帧，边发送边检测碰撞，主机 A 很快就将该帧发送完毕了，之后就不再针对该帧检测碰撞。在该帧的传输过程中，主机 C 也要发送帧，主机 C 检测到总线空闲 96 比特时间后就立即发送帧，尽管总线实际上并不空闲，这必然会产生碰撞，主机 D 最终会收到主机 A 发送的并遭遇碰撞的帧，主机 D 会将该帧丢弃，但对于主机 A 而言，它并不知道自己已发送完毕的该帧，在总线上传输的过程中遭遇了碰撞，因此不会重发。

该帧很显然使用 CSMACD 协议，以太网的帧长不能太短，以太网规定最小帧长为 64 字节，即 512 个比特。而发送 512 个比特的时间，即为争用期，如果要发送的数据非常少，那么必须加入一些填充字节，使帧长不小于 64 字节。

以太网的最小帧长，确保了主机可在帧发送完成之前，就要检测到该帧在发送过程中是否遭遇了碰撞。

如果在争用期也就是共发送 64 节所耗费的时间内，没有检测到碰撞，那么后续发送的数据就一定不会发生碰撞。

如果在争用期内检测到碰撞，就立即终止发送，这时已经发送出去的数据一定小于 64 字节，因此凡长度小于 64 字节的帧，都是由于碰撞而异常终止的无效帧。

​![](https://image.peterjxl.com/blog/image-20211221221804-dh5eorz.png)​

‍

---

既然以太网规定了最小帧长，那么是否还规定了最大帧长？我们来举例说明，假设主机 A 正在给主机 D 发送一个很长的帧，这会使得主机 A 长时间占用总线，而总线上的其他主机迟迟拿不到总线的使用权。另外由于帧很长，还可能导致主机 D 的接收缓冲区无法装下该帧而产生溢出，因此以太网的帧长应该有其上限。

例如这是以太网版本二的 MAC 格式，其数据载荷的最大长度为 1500 字节，加上首部和尾部共 18 字节，帧的最大长度为 1518 字节，而数据载荷的最小长度不能小于 46 字节，这样加上首部和尾部共 18 字节，正好满足帧的最小长度为 64 字节。

这是插入 VLAN 标记字段后的 802.1Q 帧，其数据载荷的最大长度为 1500 字节，加上首部和尾部共 22 字节，帧的最大长度为 1522 字节，而数据载荷的最小程度不能小于 42 字节，这样加上首部和尾部共 22 字节，正好满足帧的最小长度为 64 字节。

​![](https://image.peterjxl.com/blog/image-20211221221938-1i7vdkg.png)​

‍

---

接下来我们介绍退避时间的计算方法，也就是截断二进制指数退避算法，退避时间等于基本退避时间乘以随机数 R。其中基本退避时间的取值为争用期 2T，而随机数 R 是从离散的整数集合，0，1 一直到 2 的 K 次-1 中随机选出的一个数，K 从重传次数，数值时装取小者，这也是该算法名称中截断二进制指数这种称谓的由来。我们来举例说明退避时间的计算。

假设这是第一次重传，K 从重传次数 1 和 10 中取小者，也就是 1 则离散的整数集合为 0，1.则可能的退避时间为 0×2t，1× 2T。

假设这是第二次重传，K 从重传次数 2 和 10 中取小者，也就是 2 则离散的整数集合为 0，1，2，3，则可能的配比时间为 0×2T，1×2T，2×2T，3× 二 2T。

假设这是第 12 次重传，K 从重传次数 12 和 10 中取小者，也就是 10 则离散的整数集合为 0，1，2 一直到 1023，则可能的退避时间为 0×2T，1×2T，2×2T，一直到 1023×2T。

从该例可以看出，若连续多次发生碰撞，就表明可能有较多的主机参与竞争性的，但使用上述推比算法，可使重传需要推迟的平均时间，随重传次数而增大，这也 × 为动态退避，因而减小发生碰撞的概率，有利于整个系统的稳定。

当重传多达 16 次仍不能成功时，表明同时打算发送帧的，主机太多，以至于连续发生碰撞，则丢弃该帧，并向高层报告。

​![](https://image.peterjxl.com/blog/image-20211221222217-1ld1zq0.png)​

‍

---

接下来我们来讨论一下使用 CSMACD 协议的共享式以太网的信道利用率。如图所示横坐标为时间，总线上的某个主机可能发生多次碰撞，进行多次退避后，成功发送了一个帧，帧的发送时延即为 T0。在最极端的情况下，源主机在总线的一端，而目的主机在总线的另一端，因此还要经过一个单程端到端的传播实验 T 后，总线才能完全进入空闲状态。因此发送一帧所需的平均时间为多个争用期 2T，加上一个帧的发送时延 T0，再加上一个单程端到端的传播时延 T：

​![](https://image.peterjxl.com/blog/image-20211221222543-6qu2nhp.png)​

‍

---

考虑以下这种理想情况，各主机发送帧都不会产生碰撞，总线一旦空闲，就有某个主机立即发送帧，因此这部分时间就不存在了。发送一帧所占用总线的时间为 T0 加上 T，而帧本身的发送时间为 T0，这样就可得出极限信道利用率的表达式，将分子分母同除以 T0，将 T 除以 T0 系为参数 A 为了提高性到利用率，参数 A 的值应尽量小，要使参数 A 的值尽量小，则 T 的值应该尽量小，这意味着以太网端到端的距离应受到限制，不应太长，而 T0 的值应当尽量大，这意味着以太网的帧长应尽量大一些。

​![](https://image.peterjxl.com/blog/image-20211221222638-j2ajv53.png)​

‍

---

接下来我们给出 CSMACD 协议的帧发送流程图，这是载波监听部分，这是碰撞检测部分，这是检测到碰撞后的处理部分。

​![](https://image.peterjxl.com/blog/image-20211221222720-7eyaexb.png)​

‍

---

再来看 CSMACD 协议的帧接收流程图，若接收到的帧的长度小于最短帧长，则认为该帧遭遇到了碰撞，丢弃该帧，若接收到的帧的目的 MAC 地址与接收方的 MAC 地址相同，或是广播地址，则继续进行后续判断，否则丢弃该帧。

若使用循环冗余校验，检查出正在传输过程中出现了误码，则丢弃该帧。

只要正确通过上述三个检查，主机才能接受所收到的帧。

​![](https://image.peterjxl.com/blog/image-20211221222758-bwi9k9b.png)​

‍

---

接下来我们来做几个相关的练习题，这是计算机专业考研全国统考计算机网络部分 2015 年的题 36，答案是选项 B。

​![](https://image.peterjxl.com/blog/image-20211221222943-n06h9z1.png)​

选项 A 描述的是碰撞检测或称冲突检测，这是 CSMACD 协议中的一部分，描述正确，选项 B 的描述错误，因为 CSMACD 协议并不适用于无线网络，对于无线网络可以使用 CSMACA 协议，选项 C 中给出的网络跨距，相当于给出了端到端传播实验 T，进而可以得出争用期 1T，在乘以数据传输速率即为最小帧长，描述正确。选项 D 描述正确，这可以从极限信道利用率的计算公式看出，当它趋近于零时，信道利用率趋近于 100%。

‍

---

再来看 2009 年的题 37，答案是选项 D ：

​![](https://image.peterjxl.com/blog/image-20211222202725-ve4shpk.png)​

本题考察的是采用 CSMACD 协议的共享式以太网的最小帧长的相关概念，设最远两个站点之间的距离为 D 米，最小帧长为 L 比特，最小帧长等于争用期乘以数据传输速率，将题目所给的各已知量统一单位后，与之前所设的两个未知量 D 和 L 带入上式，就可以得出最远两个站点之间的距离 D 与最小帧长 L 的关系式。很显然若最小帧长减少 800 比特，最远的两个站点之间的距离至少会减少 80 米。

‍

‍

再来看 2010 年的题 47 的第一问，根据题意可画出如下所示的示意图，只有两主机同时发送数据，才能使得他们从开始发送数据时刻起到他们都检测到冲突时刻止，所经过的时间最短，如图所示，这段时间包括主机发送的数据信号，传播到距离终点处，所耗费的传播时延，以及发生碰撞后的碰撞信号，传播回主机做耗费的时间，这与之前的传播时延是相等的。因此这段时间实际上是两主机间单程的传播时延，计算如下，

再来看这样一种情况，主机甲发送的数据信号传播到无限接近主机乙的某个时刻，主机乙也要发送数据，它检测到信道空闲，但实际上信道此时并不空闲，就立刻开始发送数据，这必然会导致碰撞。如图所示主机已会首先检测到碰撞，一段时间后主机甲也会检测到碰撞，如图所示。很显然从开始发送数据时刻起到两台主机，均检测到碰撞时刻止，最长需要经过的时间为两台主机间信号传播的往返时延，也就是争用期 2T，计算如下：

​![](https://image.peterjxl.com/blog/image-20211222202842-kigyirb.png)​

‍

‍

‍

​![](https://image.peterjxl.com/blog/image-20211222202934-754xeq6.png)​

‍

‍

‍

‍

‍

本节课的内容小结如下：

需要提醒大家注意的，是 CSMA/CD 协议曾经用于各种总线结构以太网和双绞线以太网的早期版本中，现在的以太网基于交换机和全双工连接，不会有碰撞，因此没有必要使用 CSMA/CD 协议。

​![](https://image.peterjxl.com/blog/image-20211222203005-m6i3usq.png)​

‍

‍

## 3.6.4 随机接入 CSMA/CA 协议

在上节课中我们介绍了总线型局域网使用的媒体接入控制协议 CSMA/CD，本节课我们介绍无线局域网使用的媒体接入控制协议，CSMA/CA 也就是载波监听多址接入/碰撞避免。请大家思考一下，既然 CSMA/CD 协议已经成功的应用于使用广播信道的有线局域网，那么同样使用广播信道的无线局域网，能不能也使用 CSMA/CD 协议？

在无线局域网中仍然可以使用载波监听多址接入，即在发送帧之前，先对传输媒体进行载波监听，若发现有其他站在发送帧就推迟发送，以避免发生碰撞。

但是在无线局网中不能使用碰撞检测 CD，原因如下：

* 由于无线信道的传输条件特殊，其信号强度的动态范围非常大，无线网卡上接收到的信号强度往往会远远小于发送信号的强度，可能相差百万倍。如果要在无线网卡上实现碰撞检测，对硬件的要求非常高
* 即使能够在硬件上实现无线局域网的碰撞检测功能，但由于无线电波传播的特殊性，例如存在隐蔽站问题，进行碰撞检测的意义也不大

---

如图所示，这里有 4 个无线站点，A 的信号范围可以覆盖到 B 但不能覆盖到 C，C 的信号范围可以覆盖到 B 但不能覆盖到 A。换句话说 A 和 C 都检测不到对方的无线信号，当 A 和 C 都要给 B 发送帧时就会产生碰撞，但 A 和 C 无法检测到碰撞，这种未能检测出信道上其他站点信号的问题，叫做隐蔽站问题。

而同样使用广播信道的有线局域网就不存在这样的问题。例如总线上某个主机发送的信号，最多经过一个总线端到端传播时延，就会被总线上的各主机接收到，而总线上产生的碰撞信号最多经过一个总线端到端往返传播时延也会传遍总线。

​![](https://image.peterjxl.com/blog/image-20211222204446-03e4umm.png)​

‍

‍

---

因此 802.11 无线局域网使用 CSMACA 协议，在 CSMA 的基础上增加了一个 CA 也就是碰撞避免功能，而不再实现 CD 也就是碰撞检测功能。由于不可能避免所有的碰撞，并且无线信道误码率较高。802.11 标准还使用了数据链路层确认机制，具体为停止等待协议，来保障数据被正确接收。

* 802.11 的 MAC 层标准，定义了两种不同的媒体接入控制方式，一种是分布式协调功能 DCF，在 DCF 方式下，没有中心控制站点，每个站点使用 CSMACA 协议，通过争用信道来获取发送权，这是 802.11 定义的默认方式。
* 另一种是点协调功能 PCF。PCF 方式使用集中控制的接入算法，一般在接入点 AP 实现集中控制，是 802.11 定义的可选方式，在实际中较少使用。

‍

​![](https://image.peterjxl.com/blog/image-20211222204627-lrnovqc.png)​

‍

---

802.11 标准规定，所有的站点必须在持续检测到信道空闲一段指定时间后才能发送帧，这段时间称为帧间间隔 IFS。帧间间隔的长短取决于该站点要发送的帧的类型，高优先级帧需要等待的时间较短，因此可优先获得发送权。低优先级帧需要等待的时间较长，若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙状态，因而低优先级帧就只能在推迟发送了，这样就减少了发生碰撞的机会。

常用的两种帧间间隔如下，一种是短帧间间隔 SIFS，长度为 28 微秒，是最短的帧间间隔，用来分隔开属于一次对话的各个帧，一个站点应当能够在这段时间内从发送方式切换到接收方式。使用 SIFS 的帧类型有 ACK 帧、CTS 帧，由过长的 MAC 帧分片后的数据帧，以及所有回答 AP 探询的帧，和在 PDF 方式中接入点 AP 发送出的任何帧。

另一种是 DCF 帧间间隔，DCF 长度为 128 微妙，它比短帧间间隔 SIFS 要长得多，在 DCF 方式中用来发送数据帧和管理帧。

​![](https://image.peterjxl.com/blog/image-20211222204859-4qqr5mf.png)​

---

接下来我们来举例说明，CSMACA 协议的工作原理，如图所示，这些是无线站点，横坐标为时间。假设无线信道是空闲的，源站有数据帧要发送，当源站检测到信道空闲，则在等待帧间间隔 DIFS 后发送该数据帧。目的站若正确收到该数据帧，则经过帧间间隔 SIFS 后向源站发送确认帧 ACK。需要说明的是，若源站在规定时间内没有收到确认帧 ACK，由重传计时器控制这段时间，就必须重传该数据帧，直到收到确认为止，或者经过若干次的重传失败后放弃发送。

请大家思考一下，源站为什么在检测到信道空闲后，还要在等待帧间间隔 DISS 后才发送数据帧？

**这就是考虑到可能有其他的站，有高优先级的帧要发送，若有就让高优先级帧先发送**，

个人理解：为了避免检测到空闲的那个时刻后，马上就有高优先级的帧发送，这时要等它发完，避免碰撞。

​![](https://image.peterjxl.com/blog/image-20211222211711-tdyp20p.png)​

‍

‍

那么目的站又是为什么在正确接收数据之后，还要再等待一段时间 SIFS 才能发送 ACK 帧？ SIFS 是最短的帧间间隔，用来分割开属于一次对话的各个帧。在这段时间内，一个站点应当能够从发送方式切换到接收方式，如图所示，在源站和目的站的一次对话过程中，无限信道处于忙状态，若无线信道处于忙状态时，其他无线站点要发送数据，则必须退避。当信道从忙状态转换到空闲状态，并经过帧间间隔 DIFS 后，其他要发送数据的无线站点，需要退避一段随机时间后才能发送。

​![](https://image.peterjxl.com/blog/image-20211222211811-os8qjcu.png)​

‍

那么既然信道已经由忙转为空闲，且经过中间间隔 DIFS 后，为什么还要退避一段随机时间才能使用信道，而不是立即使用信道，这样做的目的在于防止多个站点同时发送数据而产生碰撞。

‍

当站点检测到信道是空闲的，并且所发送的数据帧不是成功发送完上一个数据帧之后，立即连续发送的数据帧，则不使用退避算法。

而以下情况必须使用退避算法：

* 在发送数据帧之前，检测到信道处于忙状态时，必须使用退避算法，
* 在每一次重传一个数据帧时，必须使用退避算法，
* 在每一次成功发送后，要连续发送下一个帧时，必须使用退避算法，这是为了避免一个站点长时间占用信道。

‍

‍

---

下面我们来介绍 CSMA CA 协议的退避算法。在执行退避算法时，站点为退避计时器，设置一个随机的退避时间，当退避计时器的时间减小到 0，就开始发送数据，当退避计时器的时间还未减小到零时，而信道又转变为忙状态，这时就要冻结蜕皮计时器的数值，重新等待信道变为空闲。在经过帧间间隔 DIFS 后，继续启动退避计时器，在进行第 i 次退避，退避时间在实际编号 01 2~2+X-1 中，随机选择一个然后乘以基本退避时间，也就是一个时隙的长度，就可以得到随机的退避时间。这样做是为了使不同站点选择相同退避时间的概率减少，当时隙编号达到 255 时，对应于第 6 次退避，就不再增加了。

‍

​![](https://image.peterjxl.com/blog/image-20211222210153-h1b24kt.png)​

‍

‍

---

我们来举例说明，DSMACA 协议的退避算法，如图所示 ABCDE 是 5 个无线站点，横坐标为时间，假设 A 正在占用无线信道发送帧，在 A 的发送过程中，BCD 也要发送帧，我们用向上的箭头来表示，于是进行载波监听，发现信道忙需要退避，根据退避算法，选择出一个随机的退避时间，并在每个时隙对信道进行一次检测。当检测到信道由忙状态转为空闲状态，且经过帧间间隔 DIFS 后，退避计时器开始倒计时。假设 C 的退避时间最短，当 C 的退避计时器到时后，C 立即开始发送帧，此时信道由空闲状态转换为忙状态。当 B 和 D 检测到信道忙后，就冻结各自剩余的退避时间。

假设在 C 占用无线信道发送帧的过程中，E 也要发送帧，于是进行载部监听，发现信道忙需要退避，根据退避算法，选择出一个随机的退避时间，并在每个时隙对信道进行一次检测。当检测到信道由忙状态转为空闲状态，且经过帧间间隔 DIFS 后退避计时器开始倒计时。

当 B 和 D 检测到信道由忙状态转为空闲状态，且经过帧间间隔 DIFS 后，退避计时器重新开始，从上次冻结的退避剩余时间开始倒计时，D 的退避计时器会首先到时，D 立即开始发送帧，此时信道由空闲状态转换为忙状态，当 BE 检测到心脑门后，就冻结各自剩余的退避时间，当 D 发送完帧后，信道将转为空闲状态，当 BE 检测到信道由忙状态转换为空闲状态，且经过帧间间隔 DIFS 后退避计时器重新开始，从上次冻结的退币剩余时间开始倒计时，E 的退避计时器会首先到时，E 立即开始发送帧，此时信道由空闲状态转换为忙状态，

当 B 检测到信道忙后，就冻结自己剩余的退避时间。当 E 发送完帧后，信道将转为空闲状态，当 B 检测到信道由忙状态转换为空闲状态，且经过帧间间隔 DISS 后，退避计时器重新开始，从上次冻结的退避剩余时间开始倒计时。当 B 的退避计时器到时候，B 立即开始发送帧。

若 B 发送完这一帧后，还有帧要发送，则在检测到新的空闲，且经过中间间隔 DFIS 号还必须再退避一段随机时间后才能发送。

​![](https://image.peterjxl.com/blog/image-20211222210538-a7hysd0.png)​

‍

---

接下来我们介绍 CSMACA 协议的信道预约和虚拟载波监听。为了尽可能减少碰撞的概率和降低碰撞的影响，802.11 标准允许要发送数据的站点对信道进行预约。我们来举例说明，源站在发送数据帧之前，先发送一个短的控制帧，称为请求发送 RTS。它包括源地址、目的地址以及这次通信，包括相应的确认帧所需的持续时间。如图所示，当源站检测到新的空闲，且经过帧间间隔 DIFS 后，发送 RTS 帧，若目的站正确收到源站发来的 RTS 帧，在检测到新的空闲线，经过中间间隔，SIFS 后就发送一个响应控制帧，称为允许发送 CTS。它也包括这次通信所需的持续时间，如图所示，源站收到 CTS 证后，在等待一个帧间间隔，SIFS 后就可发送其数据帧，如图所示。

若目的站正确收到了源站发来的数据帧，在等待一个帧间间隔 SIFS 号，就像源站发送确认帧 ACK，如图所示。

除源站和目的站以外的其他各站，在收到 CTS 帧或数据帧后，就推迟接入到无线局域网中，这样就保证了源站和目的站之间的通信不会受到其他站的干扰。如图所示。

如果 RTS 帧发生碰撞，源站就收不到 CTS 帧，需要执行退避算法，重传 RTS 帧。由于 RTS 帧和 CTS 帧很短，发生碰撞的概率，碰撞产生的开销以及本身的开销都很小。而对于一般的数据帧，其发送时延往往大于传播时延，碰撞的概率很大，且一旦发生碰撞，而导致数据帧重发，则浪费的时间就很多。因此用很小的代价对信道进行预约往往是值得的。802.11 标准规定了三种情况，供用户选择。

* 一种是使用 RTS 帧和 CTS 帧
* 另一种是不使用 RTS 帧和 CTS 帧，
* 还有一种是只有当数据帧的长度超过某一数值时，才使用 RTS 帧和 CTS 帧。

​![](https://image.peterjxl.com/blog/image-20211222210818-sovgke9.png)​

‍

---

除 RTS 帧和 CTS 帧会携带通信需要持续的时间，数据帧也能携带通信需要持续的时间，这称为 802.11 的虚拟载波监听机制。由于利用虚拟载波监听机制，站点只需要监听到 RTS 帧、CTS 帧或数据帧中的任何一个就能知道信道被占用的持续时间，而不需要真正监听到信道上的信号。因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题。

例如这是 4 个无线站点，A 和 C 互为隐蔽站，A 的信号可以覆盖到 B 但不能覆盖到 C C 的信号可以覆盖到 B 但不能覆盖到 A。A 在给 B 发送数据之前，可以使用 RTS 帧来预约信道，尽管 C 收不到该 RTS 帧，但是 C 可以收到 B 发送给 A 的 CTS 帧，这样 A 就知道了信道将被占用多长时间

在这段时间内，C 都不会争用信道，也就是说 A 给 B 发送数据帧时不会受到 C 的干扰。

​![](https://image.peterjxl.com/blog/image-20211222210934-nh6lpgb.png)​

‍

‍

---

这是计算机专业考研全国统考计算机网络部分 2011 年的题 36，答案是选项 D

CSMA 是指载波监听多址接入，他并不使用确认机制。

CSMA/CD 是指载波监听多址接入/碰撞检测，是对 CSMA 的改进，是早期共享总线以太网使用的信道访问控制协议，他并不使用确认机制。

CSMA/CA 是指在不监听多址接入碰撞避免，是 802.11 局域网采用的无线信道访问控制机制。802.11 局域网在使用 CSMA/CA 的同时，还使用停止等待协议，这是因为无线信道的通信质量远不如有限信道。因此无线站点每发送完一个数据之后，要等到收到对方的确认之后，才能继续发送下一帧。

CDMA 是指码分多址，属于静态划分性道，是物理层的信道复用技术，而不属于 MAC 协议。

​![](https://image.peterjxl.com/blog/image-20211222211120-vke3mig.png)​

‍

‍

---

再来看 2013 年的题 36，答案是选项 B CDMA 是指码分多址，TDMA 是指时分多址，MDMA 是指评分多址 CSMA 是指在播监听，多址接入。

TDMA，FDMA，CDMA 是常见的物理层信道复用技术，属于静态划分信道，用于多用户共享信道，不会发生冲突。

CSMA 属于争用型的媒体接入控制协议，连接在同一媒体上的多个站点，使用该协议，以竞争方式发送数据帧，可能出现冲突，也称为碰撞。

​![](https://image.peterjxl.com/blog/image-20211222211241-53hbjcc.png)​

‍

‍

---

再来看 2018 年的题 35，答案是选项 D。

本题考察本节课我们刚刚介绍过的 CSMA/CA 协议的信道预约方法，CSMA/CA 协议使用 RTS 帧和 CTS 帧来预约信道，他们都携带有通信需要持续的时间。另外除 RTS 和 CTS 帧外，数据帧也能携带通信需要持续的时间，这就是 802.11 的虚拟载波监听。

​![](https://image.peterjxl.com/blog/image-20211222211325-5fu57jr.png)​

‍

‍

本节课的内容小结如下：

​![](https://image.peterjxl.com/blog/image-20211222211332-heoaqir.png)​

‍

‍

‍
