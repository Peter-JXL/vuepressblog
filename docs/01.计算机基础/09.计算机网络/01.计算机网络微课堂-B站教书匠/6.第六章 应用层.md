---
title: 第六章 应用层
date: 2022-10-24 17:15:41
permalink: /Network/application-layer/
categories:
  - 计算机基础
  - 计算机网络
  - 计算机网络微课堂-B站教书匠
tags:
  - 
---
# 第六章 应用层

![](https://image.peterjxl.com/blog/90.png)

上层软件是怎么使用网络协议的？

<!-- more -->

## 6.1 应用层概述

　　从本节课开始，我们进入第6章应用层的学习。本节课我们对应用层进行概述，在之前的课程中，我们按计算机网络体系结构，由低到高的顺序，依次学习了物理层、数据链路层、网络层、运输层。

　　物理层解决使用何种信号来传输比特的问题。  
数据链路层解决分组在一个网络或一段链路上传输的问题。  
网络层解决分组在多个网络上传输和路由的问题。  
运输层解决进程之间基于网络的通信问题，  
而计算机网络体系结构中的应用层享受旗下各层提供的服务，解决通过应用进程的交互来实现特定网络应用的问题。

　　应用层是计算机网络体系结构的最顶层，其功能是设计和建立计算机网络的最终目的，也是在计算机网络中发展最快的部分。从早期基于文本的应用，例如电子邮件、远程登录，文件传输，新闻组等到20世纪90年代，将因特网带入千家万户的万维网，再到当今流行的即时通信，p 2p文件共享， 以及各种音视频应用，网络应用一直层出不穷。

　　此外，计算设备的小型化和无处不在，宽带住宅接入和无线接入的日益普及和迅速发展，为未来更多的新型网络应用提供了广阔的舞台。在本章中，我们将以一些经典的网络应用为例，来学习有关网络应用的原理，协议和实现方面的知识。例如我们在浏览器的地址栏中输入某个网站的域名号，就可以访问该网站的内容，这就是推动因特网飞速发展的万维网应用。其相关的应用层协议为超文本传送协议HTTP。用户在浏览器地址栏中输入的是建明之一的域名，而TCP/IP体系的网际层是用IP地址来标识目的主机，从域名到IP地址的转换工作，有属于应用层范畴的域名系统DNS在后台帮用户自动完成，以方便用户的使用。除了万维网应用和域名系统外，常见的应用还有动态主机配置DHCP，电子邮件，文件传送和p2p文件共享，多媒体网络应用等。我们将在本章的后续课程中分别介绍这些网络应用的相关协议和基本工作原理。

　　‍

　　![](https://image.peterjxl.com/blog/image-20211219165955-zn30b6r.png)

　　‍

　　‍

　　本节课的内容小结如下，

　　![](https://image.peterjxl.com/blog/image-20211219170149-jlthfkc.png)

## 6.2 客户—服务器方式和对等方式

　　‍

　　‍

　　本节课我们介绍客户服务器方式和对等方式。我们知道网络应用程序运行在处于网络边缘的不同端系统上，通过彼此间的通信来共同完成某项任务。因此开发一种新的网络应用，首先要考虑的问题就是网络应用程序，在各种端系统上的组织方式和他们之间的关系。

　　目前流行的主要有以下两种，一种是客户服务器方式，也称为CS方式，另一种是对等方式，也称为P2P方式。

　　我们首先来看客户服务器方式，客户和服务器是指通信中所涉及的两个应用进程，客户服务器方式所描述的是进程之间服务和被服务的关系。

　　我们来举例说明，如图所示处于网络边缘的主机a中运行的是客户程序，正在运行的客户程序，称为客户进程，也可简称为客户。需要注意的是运行客户进程的主机应称为客户计算机，但有时也简称为客户。处于网络边缘的主机b中，运行的是服务器程序，正在运行的服务器程序称为服务器进程，也可简称为服务器。

　　需要注意的是运行服务器进程的主机应称为服务器计算机，但有时也简称为服务器。  
在客户服务器方式下，客户向服务器请求服务，服务器收到服务请求后，向客户提供服务也就是说，客户是服务的请求方，服务器是服务的提供方，服务器总是处于运行状态，并等待客户的服务请求。  
服务器具有固定的运输层、端口号，例如HTTP服务器的默认端口号为80，而运行服务器的主机也具有固定的IP地址，

　　CS方式是因特网上传统的，同时也是最成熟的方式。很多我们熟悉的网络应用采用的都是CS方式，包括万维网、电子邮件、文件传输等。基于CS方式的应用服务，通常是服务集中型的，即应用服务，集中在网络中比客户计算机少得多的服务器计算机上。由于一台服务器计算机要为多个客户机提供服务，在CS应用中常会出现服务器计算机跟不上众多客户机请求的情况。为此，在CS应用中常用计算机群集或服务器场来构建一个强大的虚拟服务器。

　　我们再来看对等方式，也就是P2P方式，在P2P方式中没有固定的服务请求者和服务提供者，分布在网络边缘，各端系统中的应用进程是对等的，被称为对等方，对等方相互之间直接通信，每个对等方既是服务的请求者，又是服务的提供者。  
我们来举例说明，如图所示处于网络边缘的主机cdef中运行着同一种P2P程序，例如某种网络下载工具软件，e和f中的P2P进程互为对等方，c和d中的P2P进程互为对等方，而e中的P2P进程还和d中的P2P进程互为对等方。我们可以想象成e的P2P进程正在从f下载文件，与此同时还为d的P2P进程提供下载服务。  
目前在因特网上流行的P2P应用，主要包括P2P文件共享，即时通信、P2P流媒体、分布式存储等。基于P2P的应用是服务分散型的，因为服务不是集中在少数几个服务器计算机中，而是分散在大量对等计算机中。这些计算机并不为服务提供商所有，而是为个人控制的桌面计算机和笔记本电脑。它们通常位于住宅校园和办公室中。P2P方式的最突出特性之一，就是它的可扩展性，因为系统每增加一个对等方，不仅增加的是服务的请求者，同时也增加了服务的提供者。系统性能不会因为规模的增大而降低，P2P方式具有成本上的优势，因为它通常不需要庞大的服务器设施和服务器带宽，为了降低成本，服务提供商对于将P2P方式用于应用的兴趣越来越大，

　　本节课的内容小结如下

　　‍

　　‍

## 6.3 动态主机配置协议DHCP

　　同学们好，欢迎大家来到我的计算机网络微课堂，本节课我们介绍动态主机配置协议DHCP。

　　我们首先来举例说明DHCP的作用。如图所示有这样一个网络拓扑，请同学们思考一下，我们应该给网络中的各主机设置怎样的网络相关配置信息，才能使他们可以正常访问网络中的WEB服务器。根据我们之前课程所介绍过的相关知识可知，需要给网络中的各主机正确配置IP地址，子网掩码，默认网关，DNS服务器的网络相关配置信息。

　　例如这是我们给该主机手工配置的网络相关配置信息，这是我们给另一台主机手工配置的网络相关配置信息。试想一下，如果网络中的主机数量比较多，则这种手工配置的工作量就比较大，并且容易出错。

　　‍

　　![](https://image.peterjxl.com/blog/image-20211219170857-agbg7fb.png)

　　‍

　　  

　　‍

　　如果我们给网络中添加一台DHCP服务器，在该服务器中设置好，可谓网络中其他各主机配置的网络配置信息。网络中各主机开机后自动启动DHCP程序，向DHCP服务器请求自己的网络配置信息，这样网络中的各主机就都可以从DHCP服务器自动获取网络配置信息，而不用手工参与。

　　![](https://image.peterjxl.com/blog/image-20211219170932-kb79yjm.png)

　　‍

　　‍

　　‍

　　‍

　　‍

　　接下来我们举例说明DHCP的工作过程，假设网络中有两台DHCP服务器和多台用户主机，为了简单而有效的描述DHCP的工作过程，我们画出网络中的这两台DHCP服务器和一台用户主机，DHCP使用客户/服务器方式，在DHCP服务器上运行DHCP服务器进程，也可简称为DHCP服务器。在用户主机上运行DHCP，客户进程也可简称为DHCP客户。DHCP是TCP协议体系应用层中的协议，它使用运输层的UDP所提供的服务，也就是说DHCP报文在运输层会被封装成为UDP，用户数据报DHCP服务器使用的UDP端口是67，DHCP客户使用的UDP端口是68，这两个UDP端口都是熟知端口，封装有DHCP报文的UDP用户数据报，在网络层会被封装成IP数据报，然后再根据所使用的网络接口，封装成相应的数据链路层的帧进行发送。例如封装城以太网帧。  
为了简单起见，在后续描述过程中，除非有特别需要，否则我们将不再每次描述DHCP报文逐层封装的过程。

　　下面我们来看看DHCP客户与DHCP服务器的交互过程，当启用主机的DHCP后，DHCP客户将广播发送DHCP发现报文封装该报文的，IP数据报的源IP地址为0.0.0.0，这是因为主机目前还未分配到IP地址，因此使用该地址来代替，目的IP地址为广播地址255.255.255.255。之所以进行广播发送，是因为主机现在并不知道网络中有哪几个DHCP服务器，它们的IP地址各是什么，由于是广播的IP数据报，因此网络中的所有设备都会收到该IP数据报，并对其层层解封。解封出封装有DHCP发现报文的UDP用户数据报，对于DHCP客户其应用层没有监听该UDP用户数据报的目的端口67的进程，也就是DHCP服务器进程，因此无法交付DHCP发现报文只能丢弃，而对于DHCP服务器且应用层始终运行着D HCP服务器进程，因此会接受该DHCP发现报文并作出响应。

　　DHCP报文的格式比较复杂，对于DHCP发现报文，我们只需要知道其内部封装有事务ID和DHCP客户端的MAC地址即可。DHCP服务器收到DHCP发现报文后，根据其中封装的DHCP客户端的MAC地址来查找自己的数据库，看是否有针对该MAC地址的配置信息，如果有则使用这些配置信息来构建并发送DHCP提供报文。如果没有，则采用默认配置信息来构建并发送DHCP提供报文，封装该报文的IP数据报的源IP地址为 DHCP服务器的IP地址，目的IP地址仍为广播地址，仍然使用广播地址的原因是主机目前还没有配置IP地址，为了使主机可以收到，只能发送广播，这样一来，网络中的所有设备都会收到该IP数据报，并对其层层解封，解封出封装有DHP提供报文的UDP用户数据报。对于DHCP服务器且应用层没有监听该UDP用户数据报，目的端口68的进程，也就是DHCP客户进程，因此无法交付DHCP提供报文，只能丢弃。  
而对于DHCP客户且应用层运行着DHC客户进程，因此会接受该DHCP提供报文，并作出相应处理。DHCP客户会根据DHCP提供报文中的事物ID来判断该报文是否是自己所请求的报文。换句话说，如果该事物ID与自己之前发送的DHCP发现报文中封装的是事物ID相等，就要表明这是自己所请求的报文，就可以接受该报文，否则就要丢弃该报文。DHCP提供报文装，还封装有配置信息，例如IP地址、子网掩码、地址租期、默认网关、DNS服务器等。需要注意的是DHCP服务器从自己的IP地址池中挑选在租用给主机的IP地址时，会使用ARP来确保所选IP地址未被网络中其他主机占用。

　　![](https://image.peterjxl.com/blog/image-20211219171549-uric9zt.png)

　　‍

　　‍

　　‍

　　在本例中DHCP客户会收到两个DHCP服务器发来的，DHCP提供报文，DHCP客户从中选择一个。一般来说选择先到的。并向所选择的DHCP服务器发送DHCP请求报文，封装该报文的IP数据报的源地址仍为0.0.0.0，因为此时DHCP客户才从多个DHCP服务器中挑选一个作为自己的DHCP服务器，他首先需要征得该服务器的同意，之后才能正式使用向该DHCP服务器租用的IP地址，目的IP地址，仍为广播地址。这样做的目的是不用像网络中的每一个DHCP服务器，单播发送DHCP请求报文，来告知他们是否请求他们作为自己的DHCP服务器。DHCP请求报文中，封装有事物ID，DHCP客户端的MAC地址，接受的租约中的IP地址，提供此租约的DHCP服务器端的IP地址等信息。

　　在本例中，假设DDCP客户选择DHCP服务器1，作为自己的DHCP服务器，并且DHCP服务器1接受该请求，于是DHCP服务器1给DHCP客户发送DHCP确认报文，封装该报文的IP数据报的源IP地址为DHCP服务器1的IP地址，目的IP地址仍为广播地址，DPHP客户收到该确认报文号，就可以使用所作用到的IP地址了。

　　需要注意的是在使用所用到的IP地址之前，主机还会使用ARP检测该IP地址是否已被网络中其他主机占用。若被占用，DHCP客户会给DHCP服务器发送DACP谢绝报文，来谢绝IP地址租约，并重新发送DHCP发现报文，若未被占用，则可以使用租约中的IP地址与网络中的其他主机通信了。当租用期过了一半时，DHCP客户会向DHCP服务器发送DHCP请求报文，来请求更新租用期，封装该报文的IP数据报的源IP地址为 DHCP客户之前租用到的IP地址，目的IP地址为PHP服务器1的地址，DHCP服务器若同意则发回DHCP确认报文，这样DHP客户就要得到了新的租用期。  
DHCP服务器若不同意，则发回DHCP否认报文。这时DHCP客户必须立即停止使用之前租用的IP地址，并重新发送DHCP发现报文，来重新申请IP地址。  
DHCP服务器若未作出响应，则在作用期过了87.5%，DHCP客户必须重新发送DHCP请求报文，然后继续等待第一次CP服务器可能做出的反应。若DHCP服务器未作出反应，则当租用期到期后，DHCP客户必须立即停止使用之前租用的IP地址，并重新发送DHCP发现报文，来重新申请IP地址。

　　DHCP客户可以随时提前终止DHCP服务器所提供的租用期，这时只需要向DHCP服务器发送DHCP释放报文段即可。综上所述，这部分是DHC P客户寻找DHCP服务器，这部分是DHCP服务器，向第一次CP客户提供IP地址租用，  
这部分是DHCP客户接受IP地址租约，  
这部分是DHCP服务器，确认IP地址租约，

　　这部分是DHCP客户进行IP地址续约，这部分是DHCP客户可以随时解除IP地址租约，

　　需要注意的是D HCP服务器再给DHCP客户挑选IP地址时，使用ARP来确保所挑选的IP地址未被网络中其他主机占用，而DHCP客户在使用所租用的IP地址之前，也会使用ARP来检测该IP地址是否已被网络中其他主机占用。

　　![](https://image.peterjxl.com/blog/image-20211219172102-cuxfcwr.png)

　　‍

　　最后我们再来看看DHCP中继代理的概念，如图所示有这样一个网络拓扑，请大家思考一下该网络中的各主机是否可以通过DHCP来自动获取的网络配置信息，答案是否定的，原因很简单，该网络中的主机广播发送DHCP发现报文，但该广播报文不会被路由器转发，而是丢弃。解决方法是给该路由器配置DHCP服务器的IP地址，并使之成为DHCP中继代理，这样该网络中的各主机就可以通过DHCP来自动获取到网络配置信息了。当该路由器收到广播的DHCP发现报文号，会将其单播转发给DHCP服务器，DHCP客户和DCCP服务器，通过该路由器的后续交互过程，我们就要不再赘述了。使用DHCP中继代理的主要原因是我们并不愿意在每一个网络上都设置一个DHCP服务器，因为这样会使DHCP服务器的数量太多

　　![](https://image.peterjxl.com/blog/image-20211219172221-1edqn8a.png)

　　‍

　　‍

　　本节课的内容小结如下

　　![](https://image.peterjxl.com/blog/image-20211219172237-hv0vdwj.png)

## 6.4 域名系统DNS

　　‍

　　本节课我们介绍域名系统DNS，我们首先来举例说明域名系统的作用。如图所示因特网中的某台主机要访问某台WEB服务器，我们只需在用户主机中运行某个浏览器软件，在其地址栏中输入要访问的WEB服务器的域名，并按下回车键即可访问到外部服务器所提供的内容，这是大家最常用的一种网络应用。

　　接下来我们在用户主机中使用ping命令来测试一下用户主机与外部服务器的连通性。可以看到我们拼的是WEB服务器的域名，但Ping命令实际上拼的是WEB服务器的IP地址，这与我们之前课程中所介绍的TCP/IP体系，采用IP地址进行选址的知识是一致的。也就是说即使不使用域名，也可以通过IP地址来寻址目的主机，但域名与IP地址相比便于人们记忆。因此对于大多数网络应用，我们一般使用域名来访问目的主机，而不是直接使用IP地址来访问。

　　对于本例简单来说，当我们在浏览器地址栏中输入某个WEB服务器的域名时，用户主机会首先在自己的DNS高速缓存中查找该域名所对应的IP地址，如果没有找到，则会向网络中的某台DNS服务器查询，DNS服务器中有域名和IP地址映射关系的数据库。当DNS服务器收到DNS查询报文号，在其数据库中进行查询，之后将查询结果发送给用户主机。

　　现在用户主机中的浏览器可以通过外部服务器的IP地址对其进行访问了。请同学们思考一下，因特网是否可以只使用一台DNS服务器，尽管理论上是可行的，但在实践中这种做法并不可取，因为因特网的规模很大，这样的域名服务器肯定会因为超负荷而无法正常工作，而且一旦域名服务器出现故障，整个因特网就会瘫痪。

　　早在1983年，因特网就开始采用层次结构的命名树，作为主机的名字，也就是我们所谓的域名，并使用分布式的域名系统。域名系统使大多数域名都在本地解析，仅少量解析需要在因特网上通信，因此系统效率很高。由于域名系统是分布式系统，即使单个域名服务器出现了故障，也不会妨碍整个系统的正常运行。

　　‍

　　接下来我们就来看看因特网域名系统所采用的层次树状结构的域名结构，域名的结构由若干个分量组成，各分量之间用点隔开，分别代表不同级别的域名。如图所示，每一级的域名都由英文字母和数字组成，不超过63个字符，不区分大小写字母，级别最低的域名写在最左边，而级别最高的顶级域名写在最右边，完整的域名不超过255个字符，域名系统既不规定一个域名需要包含多少个下级域名，也不规定每一级的域名代表什么意思，各级域名尤其上一级的域名管理机构管理，而最高的顶级域名则由因特网名称与数字地址分配机构进行管理。

　　这是我校网络信息中心的域名，https://nic.hnust.edu.cn/  
CN是顶级域名，表示中国，EDU是在其下注册的二级域名，表示教育机构，HNUST是在EDU下注册的三级域名，表示湖南科技大学，NSC是由我校自行管理的4级域名，表示网络信息中心

　　‍

---

　　顶级域名（Top Level Domain）分为以下3类，

* 一类是国家顶级域名nTLD，采用ISO 3166的规定，如CN表示中国，US表示美国，UK表示英国，
* 另一类是通用顶级域名gLTD，最常见的通用顶级域名有7个，即COM表示公司企业，NET表示网络服务机构，ORG表示非营利性组织，INT表示国际组织，EDU表示美国教育机构，GOV表示美国政府部门 MIL表示美国军事部门
* 还有一类是要反向域用于反向域名解析arpa，即IP地址反向解析为域名，

　　‍

* 在国家顶级域名下注册的二级域名均由该国自行确定。例如顶级域名为JP的日本，将企业教育和企业机构的二级域名定为AC和CO，而不用EDU和Com。
* 我国则将二级域名划分为以下两类，  
  一类是类别域名，共7个。AC表示科研机构，COM表示工商金融等企业，EDU表示教育机构，GOV表示政府部门 NET表示提供网络服务的机构，MIL表示军事机构，ORG表示非营利性组织，

  另一类是行政区域名，共34个，适用于我国的各省、自治区、直辖市，例如BJ为北京市，SH为上海市，JS为江苏省等等。需要注意的是名称相同的域名且等级未必相同。例如 COM是通用顶级域名，但我国顶级域名CN下，也有一个名称为COM的二级域名。

---

　　‍

---

　　接下来我们举例说明因特网的域名空间，它实际上是一颗倒着生长的树，在最上面的是根，但没有对应的域名，根下面一级的节点就是顶级域名，顶级域名可往下划分出二级域名，例如这是表示公司企业的顶级域名com下面划分有CCTV、IBM、TI等二级域名，分别表示中央电视台、IBM公司、TI公司，  
这是表示中国的顶级域名CN下面划分的二级域名。图中所示的域名分别表示上海、北京教育机构政府部门的。二级域名再往下划分就是三级域名。例如这是表示中央电视台的二级域名CCTV下划分的三级域名MAIL表示邮件系统，这是表示我国教育机构的二级域名EDU下划分的三级域名。图中所示的域名分别表示清华大学、湖南科技大学、复旦大学、北京大学

　　三级域名再往下划分，就是4级域名，例如这是表示湖南科技大学的3级域名，HNUST下划分的一些4级域名，分别表示湖南科技大学的网络信息中心、图书馆、邮件系统、教务处，上述这种按等级管理的命名方法，便于维护域名的唯一性，并且也容易设计出一种高效的域名查询机制。需要注意的是域名只是个逻辑概念，并不代表计算机所在的物理地点，

　　![](https://image.peterjxl.com/blog/image-20211219193242-fycy2cz.png)

---

　　域名和IP地址的映射关系，必须保存在域名服务器中，供所有其他应用查询显然不能将所有信息都储存在一台域名服务器中，DNS使用分布在各地的域名服务器，来实现域名到IP地址的转换。域名服务器可以划分为以下4种不同类型，  
一类是根域名服务器跟域名服务器是最高层次的域名服务器，每个根域名服务器都知道所有的顶级域名服务器的域名及其IP地址，因特网上共有13个不同IP地址的根域名服务器，尽管我们将这13个根域名服务器中的每一个都视为单个的服务器，但每台服务器实际上是由许多分布在世界各地的计算机构成的服务器群集。  
当本地域名服务器向根域名服务器发出查询请求时，路由器就把查询请求报文转发到离这个DNS客户最近的一个根域名服务器，这就要加快了DNS的查询过程，同时也更合理的利用了因特网的资源  
根域名服务器，通常并不直接对域名进行解析，而是返回该域名所属顶级域名的顶级域名服务器的IP地址。

　　另一类是顶级域名服务器，这些域名服务器负责管理，在该顶级域名服务器注册的所有二级域名，当收到DNS查询请求时，就给出相应的回答，可能是最后的结果，也可能是下一级权限域名服务器的IP地址。

　　还有一类是权限域名服务器，这些域名服务器负责管理某个区的域名，每一个主机的域名都必须在某个权限域名服务器处注册登记，因此权限域名服务器知道其管辖的域名与IP地址的映射关系。另外权限域名服务器还知道其下级域名服务器的地址，

　　最后一类是本地域名服务器，本地域名服务器不属于上述的域名服务器的等级结构，当一个主机发出DNS请求报文时，这个报文就首先被送往该主机的本地域名服务器，本地域名服务器起着代理的作用，会将该报文转发到上述的域名服务器的等级结构中。每一个因特网服务提供者，一个大学，甚至一个大学里面的学院，都可以拥有一个本地域名服务器，他有时也称为默认域名服务器，本地域名服务器离用户较近，一般不会超过几个路由器的距离，也有可能就在同一个局域网中，本地域名服务器的IP地址需要直接配置在需要域名解析的主机中。

　　![](https://image.peterjxl.com/blog/image-20211219193640-ph4e0x3.png)

　　‍

---

　　接下来我们介绍域名解析的过程包含以下两种查询方式，一种是递归查询，另一种是迭代查询。

　　首先来看递归查询。假设图中的主机，想知道域名Y.ABC.COM的IP地址，主机首先向其本地域名服务器进行递归查询，

　　本地域名服务器收到递归查询的委托后，也采用递归查询的方式，向某个根域名服务器查询，根域名服务器收到递归查询的委托后，也采用定规查询的方式，向某个顶级域名服务器查询，顶级域名服务器收到递归查询的委托后，也采用递归查询的方式，向某个权限域名服务器查询，当查询到域名所对应的IP地址后，查询结果会在之前受委托的各域名服务器之间传递，最终传回给用户主机。

　　再来看迭代查询，主机首先向其本地域名服务器进行递归查询，本地域名服务器采用迭代查询，他先向某个根域名服务器查询，根域名服务器、告诉本地域名服务器，下一次应查询的顶级域名服务器的IP地址，本地域名服务器向顶级域名服务器进行迭代查询，顶级域名服务器告诉本地域名服务器，下一次应查询的权限域名服务器的IP地址，本地域名服务器向权限域名服务器进行迭代查询，权限域名服务器告诉本地域名服务器所查询的域名的IP地址，本地域名服务器，最后把查询结果告诉主机，

　　由于递归查询，对于被查询的域名服务器负担太大，通常采用以下模式，从请求主机到本地域名服务器的查询，采用递归查询方式，而其余的查询是迭代查询方式，

　　![](https://image.peterjxl.com/blog/image-20211219193935-u2ks8w4.png)

　　‍

---

　　为了提高DNS的查询效率，并减轻根域名服务器的负担，和减少因特网上的DNS查询报文数量，在域名服务器中广泛的使用了高速缓存，高速缓存用来存放最近查询过的域名，以及从何处获得域名映射信息的记录，如图所示，如果不久前已经有用户查询过域名为y.ABC.COM的IP地址，则本地域名服务器的高速缓存中，应该存有该域名对应的IP地址。当主机向本地域名服务器递归查询该域名时，本地域名服务器就没有必要再向某个根域名服务器进行迭代查询了，而是直接把高速缓存中存放的上次查询结果，即该域名的IP地址告诉用户主机。

　　‍

　　![](https://image.peterjxl.com/blog/image-20211219194029-wkvrdn1.png)

　　需要注意的是，由于域名到IP地址的映射关系并不是永久不变，为保持高速缓存中的内容正确，域名服务器因为每项内容设置计时器，并删除超过合理时间的项，例如每个项目只存放两天。  
不但在本地域名服务器中需要高速缓存，在用户主机中也很需要，许多用户主机在启动时，从本地域名服务器下载域名和IP地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且只在从缓存中找不到域名时才向域名服务器查询。

　　同理，主机也需要保持高速缓存中内容的正确性。

　　‍

　　‍

---

　　最后我们来做两个相关的练习题，这是计算机专业考研全国统考计算机网络部分2010年的题40，答案是选项A

　　我们来一起分析一下本题考察的内容，就是我们刚刚才介绍过的，采用递归查询方式进行域名解析的过程，这是主机给其本地域名服务器发送的一条DNS查询。由于题目给定本地域名服务器无缓存，因此本地域名服务器收到主机的委托查询后，会向某个根域名服务器发送一条DNS查询。

　　![](https://image.peterjxl.com/blog/image-20211219194207-r4kzkjq.png)

　　‍

　　‍

　　再来看2016年的题40，答案是选项C。若主机H4的DNS高速缓存中，有该域名的DNS信息时，不需要查询任何域名服务器，这样H4无需向图中的默认域名服务器发出DNS查询，该域名服务器也无需发出DNS查询，题目给定采用迭代查询方式进行域名解析，在最坏的情况下，需要途中的本地域名服务器依次向以下域名服务器发出共4次DNS查询：根域名服务器，顶级域名服务器.COM，权限域名服务器XYZ.COM，权限域名服务器ABC.XYZ.COM。

　　![](https://image.peterjxl.com/blog/image-20211219194319-5w9d76p.png)

　　‍

　　‍

　　本节课到这里就结束了。我们将本节课的内容小结如下，需要注意的是DNS报文，是由运输层的UDP协议进行封装，运输层端口号为53，至于DNS报文的格式就不再赘述了。另外 DNS污染等安全问题也超出了本系列课程的教学大纲，有兴趣的同学可自行查阅相关资料。

　　![](https://image.peterjxl.com/blog/image-20211219194351-rgzm44k.png)

　　‍

## 6.5 文件传送协议FTP

　　本节课我们介绍文件传送协议FTP。

* 将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中，是一项基本的网络应用，即文件传送
* 文件传送协议FTP是因特网上使用的最广泛的文件传送协议

  * FTP提供交互式的访问，允许客户指明文件的类型与格式，例如指明是否使用ASCII，并允许文件具有存取权限。比如访问文件的用户必须经过授权并输入有效的口令
  * FTP屏蔽了各计算机系统的细节，因而适用于在异构网络中任意计算机之间的传送文件
* 在因特网发展的早期阶段，用FTP传送文件，约占整个因特网的通信量的1/3，而由电子邮件和域名系统所产生的通信量还要小于FTP所产生的通信量，只是到了1995年万维网的通信量才首次超过了FTP。

　　‍

　　接下来我们举例说明FTP的应用。如图所示FTP采用客户服务器方式，因特网上的FTP客户计算机可将各种类型的文件上传到FTP服务器计算机，FTP客户计算机也可以从FTP服务器计算机下载文件，根据应用需求的不同，FTP服务器可能需要一台高性能高可靠性的服务器计算机，也可能只需要一台普通的个人计算机即可。

　　例如本例也可以采用普通的个人计算机作为FTP服务器计算机，为了简单起见，我们假设FTP客户计算机与FTP服务器计算机处于同一个局域网中，我们在FTP服务器计算机中创建FTP服务器，可以使用第三方的FTP服务器软件，也可以使用操作系统自带的FTP服务器软件，例如我们可以在Windows系统中使用其自带的FTP服务器功能，创建一个FTP服务器站点，具体方法比较简单，请同学们在网上自行查阅。

　　假设这是我所创建的FTP服务器的IP地址，我们可以在FTP客户计算机中需要浏览器软件，通过该地址来访问FTP服务器，需要注意的是这里使用的是文件传送协议FTP，而不是浏览器最常用的超文本传送协议HTTP

　　‍

　　![](https://image.peterjxl.com/blog/image-20211219215057-lgn9xnc.png)

　　‍

　　‍

　　我们也可以在FTP客户计算机中需要Windows系统自带的命令行工具，通过该地址来访问FTP服务器，例如这是连接FTP服务器，采用匿名登录，因此无需输入密码，登录成功后可以列出FTP服务器当前目录下的所有文件和文件夹，可从FTP服务器下载文件，也可向FTP服务器上传文件，命令行方式需要用户记住相关命令，这对普通用户而言并不友好，因此大多数用户在FTP客户计算机上使用第三方的FTP客户工具软件，通过友好的用户界面来完成FTP服务器的登录以及文件的上传和下载。

　　![](https://image.peterjxl.com/blog/image-20211219215200-r8dswh0.png)

　　FTP的常见用途是在计算机之间传输文件，尤其是用于批量传输文件，FTP的另一个常见用途是让网站设计者将构成网站内容的大量文件，批量上传到他们的web服务器。

　　  

---

　　接下来我们介绍FTP的基本工作原理，如图所示FTP服务器监听熟知端口号21，FTP客户随机选择一个临时端口号，与其建立TCP连接，这条TCP连接用于FTP客户与服务器之间传送FTP的相关控制命令，也就是说这条TCP连接是FTP客户与服务器之间的命令通道，当有数据要传输时，FTP客户通过命令通道告知FTP服务器来与自己的另一个临时端口号建立TCP连接，即建立数据通道，这是FTP客户随机选择的另一个端口号，FTP服务器使用自己的熟知端口号20与其建立TCP连接，这条TCP连接用于FTP客户与服务器之间传送文件，也就是说这条TCP连接是FTP客户与服务器之间的数据通道，  
由于在建立数据通道时，FTP服务器主动连接FTP客户，因此称为主动模式，需要注意的是控制连接在整个会话期间一直保持打开，用于传送FTP相关的控制命令，而数据连接用于文件传输，在每次文件传输时才建立，传输结束就关闭。

　　再来看被动模式，对于FTP客户与服务器之间命令通道的建立，它与主动模式并没有什么。不同之处，在于当有数据要传输时，FTP客户通过命令通道通知FTP服务器开启某个协商好的临时端口，被动等待来自FTP客户的TCP连接，以建立数据通道，这是FTP服务器使用的与FTP客户协商好的临时端口号，这是FTP客户随机选择的另一个端口号。FTP客户发起与FTP服务器的TCP连接，以建立数据通道，由于在建立数据通道时，FTP服务器被动等待FTP客户的连接，因此称为被动模式。

　　![](https://image.peterjxl.com/blog/image-20211219215455-00p0oy9.png)

　　‍

---

　　最后我们来做两个相关的练习题，这是计算机专业考研全国统考计算机网络部分2009年的题40，答案是选项a 

　　FTP客户和服务器之间要建立以下两个并行的TCP连接，

　　一个是控制连接，在整个会话期间一直保持打开，用于传送FTP相关控制命令，

　　另一个是数据连接用于文件传输，在每次文件传输时才建立，传输结束就关闭。

　　![](https://image.peterjxl.com/blog/image-20211219215628-wnmh2ih.png)

　　‍

　　‍

　　‍

　　这是2017年的题40。答案是选项c FTP客户和服务器之间要建立控制连接和数据连接，这两个并行的TCP连接，控制连接在整个会话期间都保持打开状态，而数据连接在每次文件传输时才建立，传输结束就关闭。默认情况下，FTP使用TCP21号端口进行控制连接，TCP20号端口进行数据连接，但是是否使用TCP20号端口建立数据连接与传输模式有关，主动方式使用TCP20号端口，而被动方式由服务器和客户端自行协商决定

　　![](https://image.peterjxl.com/blog/image-20211219215724-br40akq.png)

　　‍

　　本节课的内容小结如下

　　![](https://image.peterjxl.com/blog/image-20211219215736-s04tz24.png)

　　‍

## 6.6 电子邮件

* 电子邮件是因特网上最早流行的一种应用，并且仍然是当今因特网上最重要对使用的应用之一。
* 传统的电话通信属于实时通信，存在以下两个缺点，  
  第一，电话通信的主叫和被叫双方必须同时在场。  
  第二，一些不是十分紧迫的电话，也常常不必要的打断人们的工作和休息
* 而电子邮件与邮政系统的寄信相似，  

  * 发件人将邮件发送到自己使用的邮件服务器，发现人的邮件服务器将收到的邮件按其目的地址转发到收件人邮件服务器中的收件人邮箱
  * 收件人在方便的时候访问收件人邮件服务器中自己的邮箱获取收到的电子邮件，
* 电子邮件使用方便，传递迅速，而且费用低廉，它不仅可以传送文字信息，而且还可以附上声音和图像。
* 由于电子邮件的广泛使用，现在许多国家已经正式取消了电报业务。在我国电信局的电报业务也因电子邮件的普及而濒临消失。

　　‍

---

　　‍

* 电子邮件系统采用客户服务器方式
* 其三个主要组成构件是用户代理，邮件服务器以及电子邮件所需的协议。。我们来举例说明，假设这是邮件的发送方，这是邮件的接收方。在发送方的计算机中需要使用用户代理来发送邮件，在接收方的计算机中，同样也需要使用用户代理来接收邮件，

  用户代理是用户与电子邮件系统的接口，又称为电子邮件客户端软件
* 这是发送方使用的邮件服务器，例如QQ邮件服务器，这是接收方使用的邮件服务器，例如谷歌邮件服务器，邮件服务器是电子邮件系统的基础设施，因特网上所有的服务提供商ISP都有邮件服务器，其功能是发送和接收邮件，同时还要负责维护用户的邮箱。如图所示，我们可以简单的认为邮件服务器中有很多邮箱，还有用来缓存带转发邮件的缓存
* 发送方使用用户代理通过邮件发送协议，例如SMTP将邮件发送给发送方邮件服务器，发送方邮件服务器同样通过邮件发送协议，将该邮件发送给接收方邮件服务器  
  接收方在方便的时候需要用户代理通过邮件读取协议，例如POP3从接收方邮件服务器读取邮件，  
  也就是说电子邮件所签的协议，包括邮件发送协议和邮件主体协议两类。

　　![](https://image.peterjxl.com/blog/image-20211219220441-7wvzbkb.png)

　　‍

　　‍

　　‍

　　‍

---

　　接下来我们更进一步说明上述的邮件发送和接收过程。

* 发送方的用户代理，作为SMTP客户与发送方邮件服务器中的SMTP服务器进行TCP连接，然后基于这条连接，是由SMTP协议来发送邮件给发送方邮件服务器，
* 发送方邮件服务器中的SMTP客户与接收方邮件服务器中的SMTP服务器进行TCP连接，然后基于这条连接，使用SMTP协议来发送已收到的待转发邮件给接收方邮件服务器，
* 接收方的用户代理，作为POP3客户与接收方邮件服务器中的POP3服务器进行TCP连接。然后基于这条连接，需要POP3协议，从接收方邮件服务器读取邮件，
* 可以看到这是邮件发送协议的使用范围，包含发送方用户代理到发送方邮件服务器，以及发送方邮件服务器到接收方邮件服务器这两部分，这是邮件读取协议的使用范围，只有接收方用户代理到接收方邮件服务器这一部分。

　　![](https://image.peterjxl.com/blog/image-20211219220653-b2ro3cn.png)

　　‍

---

　　接下来我们介绍属于邮件发送协议的简单邮件传送协议SMTP的基本工作原理。我们以发送方邮件服务器，使用SMTP协议给接收方邮件服务器发送待转发的邮件为例，发送方邮件服务器周期性的扫描邮件缓存，如果发现有待转发的邮件，则发送方邮件服务器中的SMTP客户会与接收方邮件服务器中的SMTP服务器进行TCP连接，端口号为25（熟知端口号），之后SMTP客户就可以基于这条TCP连接给SMTP服务器，发送SMTP命令，共14条。SMTP服务器也会给SMTP客户发送相应的应答，共21种。

　　SMTP客户与服务器之间通过命令与应答的交互方式，最终实现SMTP客户发送邮件给SMTP服务器。

　　接下来我们就要简单介绍一下该过程，当TCP连接建立成功号SMTP服务器会主动推送服务就绪应答给SMTP客户。应答代码220后面可能跟有描述信息，例如这是网易邮件服务器给出的描述信息

　　SMTP客户收到该应答后，向服务器表明身份，告知自己SMTP服务器的域名，具体命令为HELLO旗号为命令参数  
SMTP服务器若认为身份有效，则发回应答代码250，否则发回其他代码。例如421表示服务不可用  
SMTP客户收到该应答后，使用命令MAIL FROM来告诉服务器邮件来自何方。  
SMTP服务器若认为合理，则发回应答代码250，否则发回其他错误代码  
SMTP客户收到该应答后，使用命令RCP TO来告诉服务器邮件去往何方，也就是收件人邮箱  
SMTP服务器中，如果有该收件人邮箱，则发回应答代码250，否则发回其他错误代码。  
SMTP客户收到该应答后，使用DATA命令来告诉服务器，自己准备发送邮件内容了，  
SMTP服务器如果准备好接收发回应答代码354，否则发回其他错误代码。  
SMTP客户收到该应答后，就向服务器发送邮件内容，SMTP客户发送完邮件内容后，还要发送结束符 SMTP服务器若收件成功，则发回应答代码250，否则发回其他错误代码。  
SMTP客户收到该应答后，使用命令QUIT向服务器请求断开连接，  
SMTP服务器发回应答代码221，表示接受请求，并主动断开连接。

　　需要说明的是为了简单起见，我们省略了可能需要的认证过程，还省略了应答代码后面一般都跟随的简单描述信息，不同的SMTP服务器给出的相同应答代码，其后面跟随的描述信息可能不同。

　　![](https://image.peterjxl.com/blog/image-20211219221123-7vcnv79.png)

　　‍

---

　　接下来我们介绍电子邮件的信息格式，电子邮件的信息格式并不是由SMTP协议定义的，而是在RFC 822文档中单独定义。该文档已在2008年更新为RFC 5322，  
一个电子邮件有信封和内容两部分，而内容又由首部和主体两部分构成。

　　例如这是电子邮件的信封，这是电子邮件的内容，它有首部和主体，两部分构成，首部和主体的信息都需要由用户来填写。首部中包含有一些关键字，后面加上冒号，例如关键字FROM后面填入发件人的电子邮件地址，一般由邮件系统自动填入。  
关键字TO，后面填入一个或多个收件人的电子邮件，  
关键字CC后面填入一个或多个收件人以外的抄送人的电子邮件地址，抄送人收到邮件号，可看可不看邮件，可回可不回邮件，  
关键字SUBJECT，后面填入邮件的主题，它反映了邮件的主要内容，很显然最重要的关键字是To  
和SUBJECT，他们往往是必填选项，  
用户写好首部后，邮件系统将自动的将信封所需的信息提取出来，并写在信封上，所以用户不需要填写电子邮件信封上的信息。

　　在填写完首部各关键字的内容号，用户还需要撰写邮件的主体部分，这才是用户想传递给收件人的核心信息。

　　![](https://image.peterjxl.com/blog/image-20211219221356-a2x8us8.png)

　　‍

　　‍

　　‍

---

　　SMTP协议只能传送ASCII文本数据，不能传送可执行文件或其他的二进制对象。  
也就是说SMTP不能传送带，有图片、音频或视频数据的多媒体邮件，并且许多其他非英语国家的文字，例如中文、俄文，甚至带有重音符号的法文或德文，也无法用SMTP传送。  
为解决SMTP传送非ASCII文本的问题，提出了多用途因特网邮件扩展MIME。如图所示SMTP协议只能传送ASCII文本数据，这是电子邮件的收发双方，假设发送方发送到电子邮件中，包含有非ASCII数据，则不能直接使用SMTP进行传送，需要通过MIME进行转换，将非ASCII数据转换为ASCII数据，然后就可以使用SMTP进行传送了。接收方也要使用MIME对接收到的ASCII数据进行逆转换，这样就可以得到包含有非ASCII数据的电子邮件。

　　![](https://image.peterjxl.com/blog/image-20211220080855-4cou9yq.png)

　　为了实现这种转换，MIME增加了5个新的邮件首部字段，这些字段提供了有关邮件主体的信息，定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化，定义了传送编码可对任何内容格式进行转换，而不会被邮件系统改变。实际上MIME不仅仅用于SMTP，也用于后来的同样面向ASCII字符的超文本传送协议HTTP。到目前为止，我们已经介绍完了涉及邮件发送的相关内容。

　　  

---

　　接下来我们介绍涉及邮件读取的相关内容，常用的邮件读取协议有以下两个，一个是邮局协议POP。 POP3是其第三个版本，是因特网正式标准，另一个是因特网邮件访问协议IMAP，IAMP4是其第4个版本，目前还只是因特网建议标准。  
POP3是非常简单，功能有限的邮件读取协议，用户只能以下载并删除方式或下载并保留方式，从邮件服务器下载邮件到用户计算机，不允许用户在邮件服务器上管理自己的邮件。  
IAMP4是功能比POP3强大的邮件读取协议，用户在自己的计算机上就可以操控邮件服务器中的邮箱，就像在本地操控一样，因此IAMP是一个联机协议，

　　POP3和IAMP4都采用基于TCP连接的客户服务器方式。TOP3是用熟知端口110，IAMP使用熟知端口143，  
有关TOP3协议和MAP4协议的具体内容，有兴趣的同学可自行查阅相关资料，我们就要不再深入介绍了。

　　实际上本节课涵盖了电子邮件系统，涉及到的各方面基本内容，对于了解电子邮件系统的基本工作原理来说已经足够了。

　　如果同学们将来要进行电子邮件系统相关程序设计，例如编写一个电子邮件客户端软件，则还需要对相关协议的RFC文档进行深入阅读。现在越来越多的用户使用基于万维网的电子邮件，通过浏览器登录邮件服务器万维网网站，就可以撰写、收发、阅读和管理电子邮件，这种工作方式与IAMP很类似，不同的是用户计算机无需安装专门的用户代理程序，也就是电子邮件客户端软件，只需要使用通用的万维网浏览器即可。

　　邮件服务器网站通常都提供非常强大和方便的邮件管理功能，用户可以在邮件服务器网站上管理和处理自己的邮件，而不需要将邮件下载到本地进行管理。

　　我们来举例说明，基于万维网的电子邮件应用，假设用户A和B都使用网易邮件服务器，这是用户A的电子邮件地址，这是用户B的电子邮件地址，用户A要给用户B发送邮件，用户A需要浏览器登录邮件服务器网站，撰写并发送邮件给用户B。用户B也使用浏览器登录邮件服务器网站读取收到的邮件。用户A和B在发送和接收邮件时，与服务器之间使用的都是HTTP协议，而不需要使用我们之前介绍过的SMTP和POP3协议。HTTP协议是超文本传送协议，我们将在后续课程中介绍。

　　再来看另一种情况，假设用户A需要网易邮件服务器，这是他的电子邮件地址，用户C使用谷歌邮件服务器，这是他的电子邮件地址，用户A要给用户C发送邮件，用户A需要浏览器登录自己的邮件服务器网站，撰写并发送邮件给用户C，使用的是HTTP协议。用户A的邮件服务器，需要SMTP将邮件发送给用户C的邮件服务器。用户C也使用浏览器，登录自己的邮件服务器网站，读取收到的邮件，使用的也是HTTP协议。

　　![](https://image.peterjxl.com/blog/image-20211220135908-a5xdhv8.png)

　　‍

---

　　最后我们来做几个相关的练习题。这是计算机专业考研全国统考计算机网络部分2012年的题40 答案是选项D 我们来一起分析一下。题目所给的4个选项中只出现了两种协议，一种是用于邮件发送的简单邮件传送协议SMTP，另一种是用于邮件读取的邮局协议POP3，阶段1是用户1的用户代理程序，向用户1的邮件服务器发送邮件，应该使用SMTP协议。阶段2是用户1的邮件服务器，给用户2的邮件服务器，发送邮件也应该使用SMTP协议。阶段3是用户2的用户代理程序，从用户2的邮件服务器读取邮件，应该需要POP3协议。

　　![](https://image.peterjxl.com/blog/image-20211220140021-oovd7vg.png)

　　再来看2013年的题40 答案是选项A 如图所示，这是我们之前介绍过的，SMTP协议只支持传送ASCII文本数据，如果电子邮件中包含有非ASCII数据，需要经过MIME转换变成ASCII数据后，才能使用SMTP协议进行传输，因此叙述1正确。再来看我们之前介绍过的这幅图，邮件服务器之间发送邮件，采用的是SMTP协议，因此叙述2正确，用户代理给邮件服务器发送邮件，也需要SMTP协议。因此叙述3也正确，用户代理从邮件服务器读取邮件时，使用的是POP3协议，还可以使用功能更强的IMAP协议。因此叙述4错误。

　　![](https://image.peterjxl.com/blog/image-20211220203700-qu8b9hp.png)

　　‍

　　‍

　　再来看2018年的题40，答案是选项D，简单题目不再赘述

　　‍

　　![](https://image.peterjxl.com/blog/image-20211220203729-agq4yzk.png)

　　‍

　　‍

　　本节课的内容小结如下

　　![](https://image.peterjxl.com/blog/image-20211220203738-ocjdznc.png)

　　‍

　　‍

　　‍

## 6.7 万维网WWW

　　‍

　　本节课我们介绍万维网。

　　万维网并非某种特殊的计算机网络，它是一个大规模的、联机式的信息储藏所，是运行在因特网上的一个分布式应用，  
他利用网页之间的超链接，将不同网站的网页链接成一张逻辑上的信息网。  
万维网是欧洲粒子物理实验室的蒂姆伯纳斯·李Tim Berners-Lee，最初于1989年3月提出的

　　![](https://image.peterjxl.com/blog/image-20211220204022-r4johhn.png)

　　‍

　　‍

---

　　1993年2月诞生了世界上第一个图形界面的浏览器Mosaic。1995年著名的网景浏览器上市，目前比较流行的浏览器有Chrome浏览器，火狐浏览器，Safari浏览器，欧朋Opear浏览器，IE浏览器

　　浏览器最重要的部分是渲染引擎，也就是浏览器内核，负责对网页内容进行解析和显示，这是上述各浏览器使用的内核，  
不同的浏览器内核对网页内容的解析也有所不同因此。同一网页在不同内核的浏览器里的显示效果可能不同，  
网页编写者需要在不同内核的浏览器中测试网页显示效果。

　　![](https://image.peterjxl.com/blog/image-20211220204201-p9fwvak.png)

　　‍

　　‍

---

　　接下来我们举例说明万维网应用，我们在用户主机中使用浏览器来访问湖南科技大学的万维网服务器，也就是访问湖南科技大学的官方网站，我们在浏览器的地址栏中输入湖南科技大学官方网站的域名，并按下回车键后，浏览器将发送请求报文给服务器，服务器收到请求报文后执行相应操作，然后给浏览器发回响应报文，浏览器解析并渲染响应报文中的内容，这样我们就可以看到网站首页了。

　　为了方便的访问在世界范围的文档，万维网使用统一资源定位符URL，来指明因特网上任何种类资源的位置，统一资源定位符的一般形式，由以下4个部分组成，分别是协议、主机、端口、路径。我们之前在浏览器地址栏中输入的是湖南科技大学官方网站的域名，目的是获取网站首页的内容，其对应的统一资源定位符如图所示。  
当我们点击网页中的某个超链接时，将跳转到另一个网页，可以看到这是该网页相应的统一资源定位符，其中协议主机和端口与网站首页相同，不同的是路径和网页文件。

　　![](https://image.peterjxl.com/blog/image-20211220204331-m1or35s.png)

　　‍

　　‍

---

　　接下来我们介绍万维网文档，这是我们之前访问的湖南科技大学官方网站的首页，我们可以将其另存为文件，可以看到有一个扩展名为HTML的文件和一个文件夹，我们打开该文件夹看看其内容，这3个扩展名为HTM的文件是HTML文档，这5个扩展名为JS的文件，是JAVASCRIPT文档，这两个扩展名为CSS的文件，是CSS文档，其他的JPG文件和PNG文件是图片文件

　　HTML是超文本标记语言的英文缩写词，他使用多种标签来描述网页的结构和内容。  
CSS是层叠样式表的英文缩写词，他从审美的角度来描述网页的样式。  
JAVASCRIPT是一种脚本语言，用来控制网页的行为，由HTML、CSS、JAVASCRIPT编写的万维网文档，由浏览器内核负责解释和渲染。

　　我们来举例说明，这是用HTML编写的最简单的HTML文档，用浏览器打开该HTML文档，可以看到浏览器渲染出了一个非常简单的网页，在HTML文档中使用两个HTML标签来定义HTML文档的范围，在其内部需要两个HEAD标签，定义HTML文档的首部，使用两个BODY标签，定义HTML文档的主体，首部中两个Title标签之间的内容被渲染为网页的标题，两个P标签之间的内容被渲染为一个文本段落，通过本例可以看出HTML是用多种标签来描述网页的结构和内容，但是所呈现出来的内容样式过于简单，或者说不够美观。

　　我们可以在CSS文档中定义一些所需要的样式，对网页显示内容进行美化。例如我们编写了这样一个CSS文档，在其中定义了一种样式，解颜色为深粉色，字体大小为36个像素，然后我们在之前编写好的HTML文档的首部，使用LINK标签，将该CSS文档引入，将样式名称指定给主体装需要更改样式的P标签。现在我们在浏览器中进行刷新，就可以看到浏览器重新渲染出了网页内容，可以看到 HELLO WORLD段落的颜色和字体大小都发生了相应的变化。

　　接下来我们再给该网页添加一个按钮，在之前的HTML文档的主体中使用BUTTON标签来添加一个按钮，我们为该按钮指定一个发生单击事件时应该调用的处理函数，然后用JAVASCRIPT脚本语言来编写一个JS文档，在该文档中编写单击事件处理函数的具体实现代码。在HTML文档的首部使用script标签，将该JS文档引入在事件处理函数中，通过元素的ID来找到相应的元素，也就是显示HELLO WORLD的P标签，然后更改其显示内容。现在我们在浏览器中进行刷新，就可以看到我们所添加的按钮，当我们用鼠标点击该按钮时，HELLO WORLD变成了谢谢你的赞。

　　‍

　　‍

　　‍

　　‍

---

　　通过上述举例，相信同学们对HTML文档、CSS文档、JAVASCRIPT文档已经有了初步的认识，至于这些文档的具体编写，属于WEB前端开发的基础，并不属于本课程的教学大纲，我们就不再深入介绍了。需要大家注意的是这些文档都部署在服务器端，有一些是外部前端人员开发设计好的静态页面，有一些是服务器后端程序，根据用户需求自动生成的动态页面，它们都需要从服务器传送给用户的浏览器进行解析和渲染

　　这就不得不提到TCP体系应用层中的一个非常重要的协议，即超文本传输协议HTTP。HTTP定义了浏览器，即万维网客户进程，怎样向万维网服务器请求万维网文档，以及万维网服务器怎样把万维网文档传送给浏览器。我们来举例说明，我们使用用户主机来访问湖南科技大学的万维网服务器，可以看成是用户主机中的浏览器进程即客户进程，与服务器中的服务器进程，基于因特网的通信。浏览器进程，首先发起与服务器进程的TCP连接，使用熟知端口号80，基于这条已建立好的TCP连接，浏览器进程向服务器进程发送HTTP请求报文，服务器进程收到后执行相应操作，然后给浏览器进程发回HTTP响应报文

　　HTTP1.0，采用非持续连接方式，在该方式下，每次浏览器要请求一个文件都要与服务器建立TCP连接，当收到响应后就要立即关闭连接。我们来举例说明，这是客户与服务器之间通过三报文握手进行TCP连接。在这三个报文中的最后一个报文的数据载荷部分，携带有HTTP请求报文  
服务器收到后给客户发回HTTP响应报文，这是一次请求和响应所耗费的时间，即为往返时间RTT，这又是一次请求和响应所耗费的时间，RTT，这是文档的传输时延。可以看到请求一个万维网文档所吸的时间为两倍的RTT加文档的传输RTT，每请求一个文档，就要有两倍RTT的开销。

　　若一个网页上有很多引用对象，例如图片等，那么请求每一个对象都需要额外花费两倍的RTT的时间。为了减少时延，浏览器通常会建立多个并行的TCP连接，同时请求多个对象，但是这会大量占用万维网服务器的资源，特别是万维网服务器，往往同时服务于大量客户的请求，这会使其负担很重。

　　![](https://image.peterjxl.com/blog/image-20211220204938-qnqmp2n.png)

---

　　HTTP1.1采用持续连接方式，在该方式下，万维网服务器在发送响应后，仍然保持这条连接，使同一个客户和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文，这并不局限于传送同一个页面上引用的对象，而是只要这些文档都在同一个服务器上就行。为了进一步提高效率，HTTP1.1的持续连接，还可以使用流水线方式工作，且浏览器在收到HTTP的响应报文之前，就能够连续发送多个请求报文，这样的接一个的请求报文到达服务器号，服务器就发回一个接一个的响应报文，这样就节省了很多个RTT时间，使TCP连接中的空闲时间减少，提高了下载文档的效率。

　　‍

　　‍

　　‍

---

　　接下来我们介绍HTTP的报文格式，HTTP是面向文本的，其报文中的每一个字段，都是一些ASCII串，并且每个字段的长度都是不确定的。首先来看HTTP请求报文的格式，我们用很窄的小格子表示空格，用标有CRLF的格子表示回车换行  
HTTP请求报文的第一行是请求行，由方法字段开始，其后跟一个空格，后跟统一资源定位符字段，其后跟一个空格，后跟版本字段，最后是回车换行。  
从第二行开始，就是首部行，每一个首部行由首部字段名开始，其后跟一个冒号，再跟一个空格，然后是该字段的取值，最后是回车换行，可以有多个首部行，如图所示，在最后的首部行下面是一个空行，在空行下面是实体主体，通常不使用。

　　我们来举例说明HTTP请求报文的格式，这是浏览器发送的HTTP请求报文的具体内容。第一行为请求行，指明了方法GET，统一资源定位符以及HTTP的版本。这是第一个首部行。首部字段名为HOST，其值为湖南科技大学官方网站的域名，这是第二个首部行。首部字段名为connection，其值为close，这是告诉服务器，发送完请求的文档后就可以释放连接。  
这是第三个首部行。首部自办名为USER AGENT其实是浏览器的类型及版本，  
这是第4个首部行，首部字段名为ACCEPT LANGUAGE，其值为CN，这是告诉服务器，用户希望优先得到中文版本的文档。  
在最后一个首部行的下面是一个空行，该HTTP请求报文，没有实体主体

　　![](https://image.peterjxl.com/blog/image-20211220205309-e9zqn0x.png)

　　‍

　　‍

　　‍

　　‍

---

　　再来看HTTP响应报文的格式，HTTP响应报文的第一行是状态行，由版本字段开始，其后跟一个空格，后跟状态码字段，其后跟一个空格，后跟短语字段，最后是回车换行。  
除状态行外，HTTP响应报文的其他部分，与HTTP请求报文格式的对应部分是相似的，我们就要不再赘述了。状态行中的状态共分为5大类，共33种。

　　![](https://image.peterjxl.com/blog/image-20211220205412-xg1t5ur.png)

　　‍

　　‍

　　‍

　　‍

　　‍

　　我们举例说明，响应报文装常见的状态行，该状态行表示服务器接受了请求，HTTP1.1表示版本，202是状态吗，ACCEPTED是短语，也就是对状态码的简单描述，该状态行表示请求错误，  
而该状态行表示找不到所请求的页面。一般来说，浏览器并不会直接显示出服务器发来的这些状态和信息，而是以更友好的形式向用户告知服务器所返回的状态信息。  
例如当我们访问某些网站时，浏览器可能会显示类似该图所示的提示信息，其背后的本质是浏览器收到了包含这条状态行的响应报文。

　　![](https://image.peterjxl.com/blog/image-20211220205504-8zlgvtp.png)

　　‍

　　![](https://image.peterjxl.com/blog/image-20211220205518-zdzur5v.png)

　　‍

　　‍

　　‍

　　‍

---

　　在我们访问网站时，浏览器通常会使用Cookie在服务器上记录用户信息，早期的万维网应用非常简单，仅仅是用户查看存放在不同服务器上的各种静态的文档，因此 HTTP被设计成为一种无状态的协议，这样可以简化服务器的设计。  
现在用户可以通过万维网进行各种复杂的应用，如网上购物、电子商务等，这些应用往往需要万维网服务器能够识别用户。例如我们使用浏览器，在某个网站上已经注册了自己的账号，当在该网站上登录自己的账号时，除了输入用户名和密码外，我们还可以选择记住我选项，这样当我们下一次使用该浏览器再次访问该网站时，网站可以自动识别出，我们而不用我们再次输入账号信息，

　　‍

　　![](https://image.peterjxl.com/blog/image-20211220205622-v4xz1sj.png)

　　‍

　　‍

　　‍

---

　　Cookie提供了一种机制，使得万维网服务器能够记住用户，而无需用户主动提供用户标识信息。也就是说 Cookie是一种对无状态的HTTP进行状态化的技术。  
我们来举例说明Cookie的工作原理，用户主机中的浏览器进程，首先与万维网服务器中的服务器进程建立TCP连接，当用户的浏览器进程初次向服务器进程发送HTTP请求报文时，服务器进程就会为其产生一个唯一的Cookie识别码，并以此为索引，在服务器的后端数据库中创建一个项目，用来记录该用户访问该网站的各种信息，接着就会给浏览器进程发回HTTP响应报文，在响应报文中包含有一个首部字段为 SET Cookie的首部行，该字段的取值就是Cookie识别码，  
当浏览器进程收到该响应报文之后，就在一个特定的Cookie文件中添加一行，记录该服务器的域名和Cookie的识别码。  
当用户再次使用浏览器访问这个网站时，每发送一个HTTP请求报文，浏览器都会从Cookie文件中取出该网站的Cookie识别码，并放到HTTP请求报文的Cookie首部行中，服务器根据Cookie识别码就可以识别出该用户并返回该用户的个性化网页。

　　‍

　　![](https://image.peterjxl.com/blog/image-20211220205800-npdzvd5.png)

---

　　接下来我们介绍万维网缓存与代理服务器，在万维网中还可以使用缓存机制，以提高万维网的效率。万维网缓存又称为WEB缓存，可位于客户机也可位于中间系统上，  
位于中间系统上的WEB缓存，又称为代理服务器，WEB缓存把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若发现这个请求与暂时存放的请求相同，就要返回暂存的响应，而不需要按统一资源定位符的地址，再次去因特网访问该资源。

　　我们来举例说明，假设这是因特网上的某台万维网服务器，为了与万维网代理服务器的名称区分，我们简称该服务器为原始服务器，这是校园网中的某台万维网代理服务器，我们简称其为代理服务器。当校园网中的某台主机要访问因特网上的原始服务器时，他首先会向校园网中的代理服务器发送请求，若代理服务器中存放有所请求的对象，则代理服务器会向该主机发回，包含所请求对象响应，  
若代理服务器中没有所请求的对象，则代理服务器会向因特网上的原始服务器发送请求，原始服务器将包含有所请求对象的响应，发回给代理服务器，代理服务器将该响应存入WEB缓存，然后给主机发回该响应。

　　可以想象如果WEB缓存的命中率比较高，则路由器R1和R2之间的链路上的通信量将大大减少，因而可以减少校园网各主机访问因特网的时延。有的同学可能会有这样的疑问，这是原始服务器中的某个文档，这是该文档在代理服务器中的副本，假设原始服务器中的该文档已被更改之后，校园网中的某台主机要请求该文档，他首先向校园网中的代理服务器发送请求，代理服务器找到该文档后，将其封装在响应报文中发回给主机，这样主机所请求到的文档与原始服务器中的文档就不一致了。实际上原始服务器通常会为每个响应的对象设定一个修改时间字段和一个有效日期字段。当校园网中的某台主机要请求原始服务器中的该文档时，他首先向校园网中的代理服务器发送请求，若代理服务器中的该文档未过期，则代理服务器将其封装在响应报文装发回给主机，若代理服务器中的该文档已过期，则代理服务器会向因特网上的原始服务器发送请求。

　　在请求报文中包含有一个首部字段为if-modified -since的首部行，该字段的取值就是该文档的修改日期，原始服务器根据该文档的修改日期，就可判断出代理服务器中存储的该文档是否与自己存储的该文档一致，如果一致则给代理服务器发送，不包含实体主体的响应，状态码为304，短语为not modified代理服务器重新更新该文档的有效日期，然后将该文档封装在响应报文中发回给主机，如果不一致，则给代理服务器发送封装，有该文档的响应报文，如图所示，这样代理服务器就更新了该文档，然后将更新后的该文档封装在响应报文中发回给主机。

　　‍

　　‍

　　‍

　　‍

---

　　最后我们来做两个相关的练习题，这是计算机专业考研全国统考，计算机网络部分2015年的题40，答案是选项C 我们来一起分析一下请求报文的第一行为请求行指明了方法GET所请求对象的统一，资源定位符以及HTTP的版本。因此选项A的描述正确，这是请求行下面的第一个首部行。首部字段名为HOST，其值为网站的域名，因此选项B的描述正确，这是第二个首部行。首部字段名为CONNECTION，其值为CLOSE，这是告诉服务器发送完请求的文档后就可以释放连接，且非持续连接。  
若是持续连接方式，取值因为KEEP ALIVE而不是CLOSE。因此选项C的描述错误，  
这是第三个首部行，首部字段名为Cookie，其实是服务器给浏览器生成的Cookie识别码，表明该浏览器曾经访问过该网站，因此选项D的描述正确，

　　![](https://image.peterjxl.com/blog/image-20211220214333-yg7bf26.png)

　　‍

　　‍

　　‍

　　再来做这道练习题，本题稍有难度，我们来一起分析一下，这是浏览器与服务器之间通过三报文握手进行TCP连接。在这三个报文中的最后一个报文的数据载荷部分，携带有HTTP请求报文，请求的对象是RFC.HTML页面。服务器收到后给客户发回，包含有该对象的HTTP响应报文。由于RFC.HTML页面中引用了另外两个JPG小图像，则浏览器会继续依次分别请求这两个对象。很显然浏览器从开始建立TCP连接，收到全部内容为止，需要4个RTT本题的解题关键在于对HTTP中持续连接方式的理解，以及非流水线方式的理解。由于这些概念刚刚在本节课中介绍过，因此就不再赘述了。

　　‍

　　‍

　　‍

　　本节课的内容小结如下

　　![](https://image.peterjxl.com/blog/image-20211220214514-9fdo6my.png)
