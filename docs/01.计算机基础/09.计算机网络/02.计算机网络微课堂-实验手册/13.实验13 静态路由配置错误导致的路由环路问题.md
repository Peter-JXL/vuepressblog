---
title: 实验13 静态路由配置错误导致的路由环路问题
date: 2022-10-24 18:01:52
permalink: /Network/lab13-Routing-Loops/
categories:
  - 计算机基础
  - 计算机网络
  - 计算机网络微课堂-实验手册
tags:
  - 
feed:
  enable: true
description: 下面我们来进行一个仿真实验，本仿真实验的目的在于验证静态路由配置错误所导致的路由环路问题
---
# 实验13 静态路由配置错误导致的路由环路问题

![](https://image.peterjxl.com/blog/104.jpg)

　　下面我们来进行一个仿真实验，本仿真实验的目的在于验证静态路由配置错误所导致的路由环路问题

<!-- more -->


我已经在软件中构建好了我们理论课讲解时所用到的网络拓扑，并且给网络中的各设备都配置了相应的IP地址和地址掩码。对于网络中的各个主机，我还为他们指定了默认网关，对于网络中的各个路由器，我还给他们添加了静态路由，例如我给路由器R1添加了这样一条路由，那目的网络是192.168.2.0，也就是主机H2所在的网络，相应的下一跳，应该转发给R2的接口， IP地址是10.0.0.2，

　　给路由器R2添加了两条静态路由，这一条是到达主机H1所在网络的，下一跳，应该是跳给R1的接口。第二条静态路由是到达主机H2所在网络的，下一跳应该从R2跳给R3的接口，给R三添加了一条到达主机H1所在网络的静态路由，他的下一跳应该从R3转发给R2的接口

　　![](https://image.peterjxl.com/blog/image-20220103145702-nlw3733.png)

　　‍

　　‍

　　在所有配置工作完成以后，我们就可以测试一下主机H2和主机H1它们之间是否可以相互通信。那么我们用主机H2来Ping一下主机H1看一下是否可以Ping通，那么我们点击主机H2，然后在桌面选项卡里面选择命令提示行，然后我们就可以进行Ping了 PING 192.168.1.1，然后回车。第一条请求超时，第二条请求也超时了了，第3条请求也超时，那么第4条收到了来自主机H1，也就是它的IP地址192.168.1.1，收到了 H1的回来的响应。

　　为什么会出现三次超时，我们在以前的实验中已经介绍过这个原因了，主要就是通过ARP广播请求的目的MAC地址那要逐段请求那所造成的这种现象。那么一旦这个过程结束以后，我们再Ping一次，应该是可以连续收到4条响应，我们看到连续收到了4条响应，这样就证明我们这两个主机之间是可以通信的，因为我们主机H2 Ping H1 相当于发过去请求，H1还要给发回来响应，所以这样就证明了他们之间是可以互通的，进而也证明了我们的IP地址配置的是正确的，静态路由添加的也是正确的。

```js
C:\>ping 192.168.2.1

Pinging 192.168.2.1 with 32 bytes of data:

Request timed out.
Request timed out.
Request timed out.
Reply from 192.168.2.1: bytes=32 time<1ms TTL=125

Ping statistics for 192.168.2.1:
    Packets: Sent = 4, Received = 1, Lost = 3 (75% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms

```

　　‍

　　‍

　　‍

---

　　下面我们来看一下，如果我对路由器R2的第一条路由记录，由于我的疏忽，如果我把它配置错误了，会出现什么样的情况？例如现在我们看到的到达主机H1所在的网络下一跳，我给他写的是10.0.0.1，也就是应该交给 R1路由器的接口，这是我正确配置的情况。  
如果说我疏忽了，我把它配置成了R3的接口，我们待会看一下会有什么样的情况。

　　我们点击R2这个路由器，然后在配置这个选项卡里面，我们在这儿有一个路由，下面有个静态，我们可以看到这是我之前配置的两条正确的路由，现在我们要把这一条路由给它配置成错误的，也就是说到达主机H1所在这个网络是192.168.1.0，然后相应的地址掩码255.255.255.0，我要错误的是把下一跳的地址，它本来是跳给R1的接口是对的，但是我让他跳给R3的接口，也就是下一条地址我输为10.0.1.2，。我们当然我们先把之前的正确的这一条给它删除掉，然后把我刚才输的错误的给它添加进来。

　　![](https://image.peterjxl.com/blog/image-20220103150213-11zrjym.png)

　　‍

　　![](https://image.peterjxl.com/blog/image-20220103150254-nt09zqk.png)

　　下面我们就来看一下主机H2的给H1，如果发送一个ICMP的请求报文，需要H1回复一个会出现什么样的情况，我们先切换到从右下角切换到从实时切换到仿真模式，然后我们不要这么多协议，我们只显示一个ICMP协议就可以了。然后我们点击添加简单的PDU，我们让H2为源主机，让H1为目的主机，那么我们点击这里的捕获前进按钮，

　　H2先把 IP数据报给了它的默认网关，也就是R3。R3去查路由表决定把它转发给R2，而到了R 2，R2根据这个数据包里的目的IP地址也就是主机H1的192.168.1.1，查到了是在他的路由表里面的第一条记录，而第一条这个记录只是他应该给我们刚才正确的是应该给接口，也就是R1的接口，而我们刚才已经把这个地方故意给它改错了，改成R3的接口。所以它应该转发到了R3路由器，而R3路由器的话收到以后又跟里面的把它的IP目的IP取出来，发现这条记录匹配又把它发回到R2的接口。我们现在就可以看出来了，由于我给R2路由器的静态路由配置错误的，会导致 IP数据包在 R2和R3的这两个路由器之间，它会反复的这么样的转发。

　　![](https://image.peterjxl.com/blog/image-20220103150510-rkt0ybz.png)

　　‍

　　‍

　　‍

　　‍

　　当然我们可以看一下在 ICMP，当然它是封装在这个IP数据报里面，我们可以看一下入站的PDU详情，也就是这个数据包进入到路由器，那么当时他进来的生存时间是TTL还可以有248跳，然后我们看路由器决定把它转发出来，也就从这出站PDU详情。我们可以看到这个IP数据包它每经过一个路由器，它会把生命值减一那么我们再进行前进，再看一下，那么再点它我们看到路段PDU也就是它进来的时候生命值是247，那么准备把它转发出去，再点一下出战PDU路由器把它的生命值又减低了。那么直到这个IP数据报的低调的值减到0的时候，这个时候路由器就会把这个IP数据报给它丢弃掉，这样我们就验证了由于静态路由的配置错误所导致的路由环路问题

　　![](https://image.peterjxl.com/blog/image-20220103150533-p3e7fgw.png)

　　‍

　　‍

　　‍

　　![](https://image.peterjxl.com/blog/image-20220103150547-7qusxms.png)

　　‍

　　‍
