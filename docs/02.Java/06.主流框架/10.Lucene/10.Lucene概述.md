---
title: Lucene概述
date: 2023-05-16 08:56:18
permalink: /Lucene/introduce/
categories:
  - Java
  - 主流框架
  - Lucene
tags:
  - 
---
# 10.Lucene概述

　　接下来我们讲讲Lucene是如何实现查询的，为后续的入门案例做准备
<!-- more -->
　　‍

## 索引和搜索流程

　　![](https://image.peterjxl.com/blog/image-20230514163258-6ly748g.png)

　　绿色表示索引过程，对要搜索的原始内容进行索引构建一个索引库，索引过程包括：

　　确定原始内容（即要搜索的内容） → 采集文档 → 创建文档 → 分析文档 → 索引文档

　　‍

　　其实索引就是一堆文件。红色表示搜索过程，从索引库中搜索内容，搜索过程包括：

　　用户通过搜索界面 → 创建查询 → 执行搜索，从索引库搜索 → 渲染搜索结果

## 创建索引

　　对文档索引的过程，将用户要搜索的文档内容进行索引，索引存储在索引库（index）中。

　　这里我们要搜索的文档是磁盘上的文本文件，根据案例描述：凡是文件名或文件内容包括关键字的文件都要找出来，这里要对文件名和文件内容创建索引。

　　‍

　　‍

　　‍

### 获得原始文档

　　原始文档的概念：要基于哪些数据来进行搜索，那么这些数据就是原始文档。而搜索引擎的原始文档就是互联网上的HTML文件。京东的原始文档就是商品数据，微博的原始文档就是微博。

　　**原始文档**是指要索引和搜索的内容。原始内容包括互联网上的网页、数据库中的数据、磁盘上的文件等。本案例中的原始内容就是磁盘上的文件，如下图：

　　![](https://image.peterjxl.com/blog/image-20230514163611-6w0bue9.png)

　　

　　从互联网上、数据库、文件系统中等获取需要搜索的原始信息，这个过程就是信息采集，信息采集的目的是为了对原始内容进行索引。

　　在Internet上采集信息的软件通常称为爬虫或蜘蛛，也称为网络机器人，爬虫访问互联网上的每一个网页，将获取到的网页内容存储起来。

　　本案例我们要获取磁盘上文件的内容，可以通过文件流来读取文本文件的内容，对于pdf、doc、xls等文件可通过第三方提供的解析工具读取文件内容，比如Apache POI 读取Word和Excel的文件内容。

　　‍

### 创建文档对象

　　对应每个原始文档创建一个Document对象：

* 例如对于搜索引擎，一个页面就是一个Document
* 对于电商，一个商品页面就是一个Document

　　‍

　　每个document对象中包含多个域（field），域中保存就是原始文档数据，分为域的名称、域的值。例如`"FileSize":60KB`。每个文档都有一个唯一的编号，就是文档id

　　获取原始内容的目的是为了索引，在索引前需要将原始内容创建成文档（Document），文档中包括一个一个的域（Field），域中存储关于原始文档的属性。

　　这里我们可以将磁盘上的一个文件当成一个document，Document中包括一些Field（file_name文件名称、file_path文件路径、file_size文件大小、file_content文件内容），如下图：

　　![](https://image.peterjxl.com/blog/image-20230514163926-iibev36.png)

　　注意：每个Document可以有多个Field，不同的Document可以有不同的Field，同一个Document可以有相同的Field（域名和域值都相同）。每个文档都有一个唯一的编号，就是文档id。

　　‍

　　‍

### 分析文档

　　将原始内容创建为包含域（Field）的文档（document），需要再对域中的内容进行分析，分析的过程是经过对原始文档提取单词、将字母转为小写、去除标点符号、去除停用词等过程生成最终的语汇单元，可以将语汇单元理解为一个一个的单词。

　　分词的过程概述：

* 根据空格进行宇符串拆分，得到一个单词列表
* 把单词统一转换成小写
* 去除标点符号
* 去除停用词（Lucene专业术语），也就是无意义单词，例如the，and，a

> 比如下边的文档经过分析如下：
>
> Lucene is a Java full-text search engine. Lucene is not a complete application, but rather a code library and API that can easily be used to add search capabilities to applications.
>
> 分析后得到的语汇单元：Lucene、java、full、search、engine。。。。

　　‍

　　**每个关键词都封装成一个Term对象中，不同的域中拆分出来的相同的单词是不同的Term。T**erm中包含两部分：一部分是文档的Field名，另一部分是单词的内容。

　　不同的域中拆分出来的相同关键词是不同的Term。例如文件名和文件内容都包含关键词的情况。例如：文件名中包含apache，和文件内容中包含的apache，是不同的Term。

　　‍

### 创建索引

　　对所有文档分析得出的语汇单元进行索引，索引的目的是为了搜索，最终要实现只搜索被索引的语汇单元从而找到Document（文档）。

　　索引库中的内容：如下图

　　![](https://image.peterjxl.com/blog/image-20230514164843-39d4ror.png)

　　分为3个部分：

* 索引（左侧的词汇表）
* document对象（右侧的一个个Document对象）
* 关键词和文档的对应关系（中间的连线）

　　‍

　　‍

　　注意点1：索引库是保存在磁盘上的，和数据库里的索引没太多关联

　　注意点2：创建索引是对语汇单元索引，通过词语找文档，这种索引的结构叫倒排索引结构。

　　传统方法是根据文件找到该文件的内容，在文件内容中匹配搜索关键字，这种方法是顺序扫描方法，数据量大、搜索慢。**倒排索引结构**则是根据内容（词语）找文档，如下图：

　　![](https://image.peterjxl.com/blog/image-20230514164848-tgwe53s.png)

　　倒排索引结构也叫反向索引结构，包括索引和文档两部分，索引即词汇表，它的规模较小，而文档集合较大。

　　‍

　　‍

## 查询索引

　　查询索引也是搜索的过程。搜索就是用户输入关键字，从索引（index）中进行搜索的过程。根据关键字搜索索引，根据索引找到对应的文档，从而找到要搜索的内容（这里指磁盘上的文件）。

　　通过词语找文档，这种素引的结构叫倒排素引结构。也就是索引库的存储形式

　　查询索引的过程概述：

* 用户查询接口：用户输入查询条件的地方，例如百度的搜索框
* 把关键词封装成一个查询对象：要查询的域、要搜索的关键词
* 执行查询：根据要查询的关键词到对应的域上进行搜索。找到关键词，根据关键词找到对应的文档
* 渲染结果，例如查询出来的是Document的ID，可以渲染为文档名，比如百度会高亮搜索结果中的关键词，分页处理等，最终展示。

　　‍

### 用户查询接口

　　全文检索系统提供用户搜索的界面供用户提交搜索的关键字，搜索完成展示搜索结果。比如：

　　![](https://image.peterjxl.com/blog/image-20230514165014-nxzup8i.png)

　　‍

　　Lucene不提供制作用户搜索界面的功能，需要根据自己的需求开发搜索界面。

　　‍

### 创建查询

　　用户输入查询关键字执行搜索之前需要先构建一个查询对象，查询对象中可以指定查询要搜索的Field文档域、查询关键字等，查询对象会生成具体的查询语法，

　　例如：语法`"fileName:lucene"`表示要搜索Field域的内容为`"lucene"`的文档

　　‍

　　‍

### 执行查询

　　搜索索引过程：

　　根据查询语法在倒排索引词典表中分别找出对应搜索词的索引，从而找到索引所链接的文档链表。

　　比如搜索语法为"fileName:lucene"表示搜索出 fileName 域中包含 Lucene 的文档，搜索过程就是在索引上查找域为fileName，并且关键字为Lucene的term，并根据term找到文档id列表。

　　![](https://image.peterjxl.com/blog/image-20230514165031-bnv2i8z.png)

　　‍

　　‍

### 渲染结果

　　以一个友好的界面将查询结果展示给用户，用户根据搜索结果找自己想要的信息，为了帮助用户很快找到自己的结果，提供了很多展示的效果，比如搜索结果中将关键字高亮显示，百度提供的快照等。

　　![](https://image.peterjxl.com/blog/image-20230514164959-cuskk1s.png)

　　‍
