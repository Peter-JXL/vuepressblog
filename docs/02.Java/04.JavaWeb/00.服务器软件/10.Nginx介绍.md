---
title: Nginx介绍
date: 2023-04-17 09:52:11
permalink: /Nginx/0-introduce/
categories:
  - Java
  - JavaWeb
  - 服务器软件
tags:
  - 
---
# 00.Nginx介绍

![](https://image.peterjxl.com/blog/243.JPEG)

　　Nginx是一款自由的、开源的、高性能的HTTP服务器和反向代理服务器，同时也是一个IMAP、POP3、SMTP代理服务器。Nginx可以作为一个HTTP服务器进行网站的发布处理，也可以作为反向代理进行负载均衡的实现，目前使用率非常高。
<!-- more -->
　　‍

　　在介绍Nginx之前，我们先对Web服务中的一些概念做介绍。

## 什么是代理

　　说到代理，首先我们要明确一个概念，所谓代理就是一个代表、一个渠道；

　　此时就涉及到两个角色，一个是被代理角色，一个是目标角色，被代理角色通过这个代理访问目标角色完成一些任务的过程称为代理操作过程；

> 举个生活中的例子：客人到adidas专卖店买了一双鞋，这个专卖店就是代理，被代理角色就是adidas厂家，目标角色就是用户。简单来说代理就是帮目标角色办事的，例如帮忙卖鞋

　　‍

　　代理主要分为两种：正向代理和反向代理。

　　‍

## 正向代理

　　由于部分原因，我们是访问不了国外的网站的，有的人会科学上网，要怎么做呢？就是找一台可以访问国外网站的服务器，做我们的代理。我们想要访问什么网站，就发送请求给到这个代理服务器，代理服务器帮我们访问国外的网站， 然后将访问到的内容返回给我们：

　　​![](https://image.peterjxl.com/blog/1202586-20181211123717325-1261206014.png)​

　　上述这样的代理模式称为正向代理，正向代理最大的特点是客户端非常明确要访问的服务器地址，国外的网站只清楚请求来自哪个代理服务器，而不清楚来自哪个具体的客户端；正向代理模式屏蔽或者隐藏了真实客户端信息

　　注意：不仅仅是科学上网用到了正向代理，如果你想隐藏真实客户端信息，也可以使用代理。

　　‍

　　‍

　　除了Windows本身，大部分软件都支持设置代理，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。例如Windows设置代理：

　　​​![](https://image.peterjxl.com/blog/image-20230326105450-gi54p34.png)​​

　　‍

　　例如这是微信的代理设置：

　　​![](https://image.peterjxl.com/blog/image-20230326103701-g8vk1qa.png)​

　　‍

　　总的来说，正向代理，代理的是客户端，帮客户端发出请求，是一个位于客户端和原始服务器（origin server）之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标（原始服务器），然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。

　　正向代理的用途：

1. 访问原来无法访问的资源，如Google
2. 可以做缓存，加速访问资源
3. 对客户端访问授权，上网进行认证
4. 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

　　‍

## 反向代理

　　明白了什么是正向代理，我们来说说什么是反向代理。

　　举个例子，国内有不少的购物网站，每天同时连接到网站的访问人数非常多，单个服务器远远不能满足，并发量大的时候，非常容易造成服务器崩溃（例如双十一购物节的时候），这是因为单台服务器性能是有瓶颈的。也就是提高服务器的配置是不能满足的，我们得采用增加服务器的数量来解决问题，也就是集群，或者叫分布式部署，通过部署多台服务器来解决访问人数限制的问题。

　　既然有多个服务器，那么就得将请求分发到各个服务器上（也就是负载均衡，将压力平摊到各个服务器上），然后各个服务器处理后返回给客户，这就叫反向代理

　　那么反向代理具体是通过什么样的方式实现的分布式的集群操作呢？示意图：

　　​![](https://image.peterjxl.com/blog/1202586-20180406175939873-925019958.png)​

　　通过上述的图解大家就可以看清楚了，多个客户端给Nginx服务器发送请求，Nginx服务器接收到之后，按照一定的规则分发给了后端的业务处理服务器进行处理了。此时请求的来源也就是客户端是明确的，但是这个请求具体是由哪台服务器处理，就不知道了，得看Nginx的分发规则。

　　这里，Nginx扮演的就是一个反向代理角色。客户端是无感知代理的存在的，反向代理对外都是透明的，访问者并不知道自己访问的是一个代理，因为客户端不需要任何配置就可以访问。

　　总的来说，反向代理，它代理的是服务端，代服务端接收请求，主要用于服务器集群分布式部署的情况下。反向代理隐藏了服务器的信息。

　　反向代理的作用：

1. 保证内网的安全，通常将反向代理作为公网访问地址，Web服务器是内网
2. 负载均衡，通过反向代理服务器来优化网站的负载

　　‍

## 项目场景

　　我们在实际项目操作时，正向代理和反向代理很有可能会存在在一个应用场景中，正向代理代理客户端的请求去访问目标服务器，目标服务器是一个反向单例的服务器，反向代理了多台真实的业务处理服务器。具体的拓扑图如下：

　　​![](https://image.peterjxl.com/blog/1202586-20180406180130452-1246060303.png)​

　　就好比一群人科学上网，使用的是同一个正向代理；正向代理访问国外的网站，由于国外的网站太多人访问了，做了一个反向代理。

　　‍

　　‍

　　正向代理和反向代理二者之间的区别：看在不在一个网段中

　　​![](https://image.peterjxl.com/blog/1202586-20181211122806997-940664368.png)​

　　‍

　　‍

## 动静分离

　　什么是动静分离？就是将动态请求和静态请求分到不同的服务器上。在早期，我们不管是请求HTML、CSS和JS等静态资源，还是访问Servlet等动态资源，都是访问Tomcat，使得Tomcat同时要处理静态和同动态资源；

　　而使用了Nginx后，我们可以将静态资源和动态资源分开，Tomcat只负责处理动态资源（例如Servlet和PHP），有另外一个服务器负责处理静态资源：

　　​![](https://image.peterjxl.com/blog/image-20230326164937-hqtb5us.png)​

　　‍

　　使用动静分离的方式，可以降低原来单个服务器的压力，加快网站的解析速度。一般来说Nginx本身就可以当作静态资源服务器，但可以配置更好更快的静态资源服务器。

　　‍

## 负载均衡

　　我们已经明确了所谓代理服务器的概念，那么接下来，Nginx扮演了反向代理服务器的角色，它是以依据什么样的规则进行请求分发的呢？不用的项目应用场景，分发的规则是否可以控制呢？

　　这里提到的客户端发送的、Nginx反向代理服务器接收到的请求数量，就是我们说的负载量，比如10s内有1000个用户访问，访问量就有1000.

　　请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则，例如平均分给不同的服务器，或者轮流分等等，有很多的规则。

　　所以，将服务器接收到的请求按照规则分发的过程，称为负载均衡。

　　​![](https://image.peterjxl.com/blog/1202586-20180406180405961-333776342.png)​

　　负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种：

* 硬件负载均衡也称为硬负载，如F5负载均衡，相对造价昂贵成本较高，但是数据的稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作；
* 更多的公司考虑到成本原因，会选择使用软件负载均衡，软件负载均衡是利用现有的技术结合主机硬件实现的一种消息队列分发机制。

　　‍

　　如果用生活中的例子来说明负载均衡：一个餐厅生意非常火爆，一个服务员不够用了，招多了几个服务员来，这样就将客流量平摊给了几个服务员，每个服务员的压力就小了

　　‍

## Nginx的历史

　　在早期，Apache非常流行，是毫无争议的世界第一大服务器。它有着很多优点：稳定、开源、跨平台等等。它出现的时间太长了，它兴起的年代，互联网产业远远比不上现在（用户规模，网络带宽点都比较小），所以它被设计为一个重量级的，不支持高并发的服务器。

　　在Apache上运行数以万计的并发访问，会导致服务器消耗大量内存。操作系统对其进行进程或线程间的切换也消耗了大量的CPU资源，导致HTTP请求的平均响应速度降低。这些都决定了Apache不可能成为高性能WEB服务器，轻量级高并发服务器Nginx（发音为“engine X”）就应运而生了。

　　俄罗斯的工程师Igor Sysoev（伊戈尔·赛索耶夫），他在为Rambler Media工作期间，使用C语言开发了Nginx，主要是为了俄罗斯访问量第二的 Rambler.ru站点开发的。

　　Nginx作为WEB服务器一直为Rambler Media提供出色而又稳定的服务，然后Igor Sysoev将Nginx代码开源（BSD许可），并且赋予自由软件许可证。

　　‍

　　‍

　　Nginx很优秀：

* Nginx使用基于事件驱动架构，使得其可以支持数以百万级别的TCP连接（占有内存少，并发能力强）
* 高度的模块化和自由软件许可证使得第三方模块层出不穷（开源的，人人都可以写第三方模块）
* 跨平台，可以运行在Linux，Windows，FreeBSD，Solaris，AIX，Mac OS等操作系统上
* 优秀的设计带来的是极大的稳定性

　　所以，Nginx目前非常流行，例如在2021年7月， Netcraft 公司发布了全球 Web 服务器调查报告，Nginx是排第一的：

　　​![](https://image.peterjxl.com/blog/image-20230326111601-8kgq820.png)​

　　Netcraft 公司官网每月公布的调研数据（Web Server Survey）已成为当今人们了解全球网站数量以及服务器市场分额情况的主要参考依据。

　　Nginx 可以作为静态页面的 Web 服务器，同时还支持 CGI 协议的动态语言，比如 perl、php等。但是不支持 Java。Java 程序只能通过与 支持Servlet的Web服务器（例如Tomcat）配合完成。

　　‍

　　‍

## 总结

　　本文我们讲了如下内容：

* 代理、正向代理和反向代理
* 负载均衡的概念
* Nginx诞生的历史
* 动静分离
* Nginx的历史

　　接下来，我们将学习Nginx的基本使用

　　‍

　　参考

* [Nginx 相关介绍(Nginx是什么?能干嘛?) - 失恋的蔷薇 - 博客园](https://www.cnblogs.com/wcwnina/p/8728391.html)：本文主要参考这篇博客
* [尚硅谷Nginx教程由浅入深（一套打通丨初学者也可掌握）_哔哩哔哩](https://www.bilibili.com/video/BV1zJ411w7SV)

　　‍
